// Legal Metadata Database Schema
// Created: 2025-10-01
// Purpose: Fast metadata queries and ChromaDB search filtering
// Database: legal_metadata.db
// dbdiagram.io

Project legal_metadata {
  database_type: 'SQLite'
  Note: '''
    # Legal Metadata Database
    법령 정보 메타데이터 관리 시스템

    ## Database Statistics (2025-10-01)
    - Total Laws: 28
    - Total Articles: 1,552

    ## Document Types
    - 법률: 9 (32%)
    - 시행령: 7 (25%)
    - 시행규칙: 7 (25%)
    - 대법원규칙: 2 (7%)
    - 용어집: 1 (4%)
    - 기타: 2 (7%)

    ## Categories
    - 1_공통 매매_임대차: 9
    - 3_공급_및_관리_매매_분양: 8
    - 4_기타: 6
    - 2_임대차_전세_월세: 5

    ## Special Articles
    - Tenant Protection: 28
    - Delegation: 156
    - Penalty Related: 1
    - Tax Related: 0
  '''
}

// =============================================================================
// Table 1: laws - 법령 기본 정보
// =============================================================================
Table laws {
  law_id integer [primary key, increment, note: '법령 고유 ID']
  doc_type text [not null, note: '법률/시행령/시행규칙/대법원규칙/용어집/기타']
  title text [not null, note: '법령명']
  number text [note: '법령번호']
  enforcement_date text [note: '시행일 (YYYY.MM.DD)']
  category text [not null, note: '카테고리 (1_공통 매매_임대차, 2_임대차_전세_월세, 3_공급_및_관리_매매_분양, 4_기타)']
  total_articles integer [default: 0, note: '총 조항 수']
  last_article text [note: '마지막 조항 번호']
  source_file text [note: '원본 파일명']
  created_at timestamp [default: `CURRENT_TIMESTAMP`, note: '생성 일시']

  indexes {
    doc_type [name: 'idx_laws_doc_type']
    enforcement_date [name: 'idx_laws_enforcement_date']
    category [name: 'idx_laws_category']
    title [name: 'idx_laws_title']
    (title, number, doc_type) [unique, name: 'unique_law']
  }

  Note: '''
    법령 기본 정보 테이블

    각 법령의 메타데이터와 기본 정보를 저장합니다.

    Example Query:
    ```sql
    SELECT * FROM laws
    WHERE title LIKE '%공인중개사법%';
    ```
  '''
}

// =============================================================================
// Table 2: articles - 조항 상세 정보
// =============================================================================
Table articles {
  article_id integer [primary key, increment, note: '조항 고유 ID']
  law_id integer [not null, ref: > laws.law_id, note: '법령 ID (외래키)']
  article_number text [not null, note: '조항 번호 (예: 제1조)']
  article_title text [note: '조항 제목']
  chapter text [note: '장']
  section text [note: '절']
  is_deleted integer [default: 0, note: '삭제 여부 (0=유효, 1=삭제)']
  is_tenant_protection integer [default: 0, note: '임차인 보호 조항 (0=아니오, 1=예)']
  is_tax_related integer [default: 0, note: '세금 관련 (0=아니오, 1=예)']
  is_delegation integer [default: 0, note: '위임 (0=아니오, 1=예)']
  is_penalty_related integer [default: 0, note: '벌칙 (0=아니오, 1=예)']
  chunk_ids text [note: 'ChromaDB chunk ID 배열 (JSON 형식)']
  metadata_json text [note: '전체 메타데이터 (JSON 형식)']

  indexes {
    law_id [name: 'idx_articles_law_id']
    article_number [name: 'idx_articles_number']
    is_deleted [name: 'idx_articles_deleted']
    is_tenant_protection [name: 'idx_articles_tenant']
    is_tax_related [name: 'idx_articles_tax']
    is_delegation [name: 'idx_articles_delegation']
    is_penalty_related [name: 'idx_articles_penalty']
    (law_id, article_number) [unique, name: 'unique_article']
  }

  Note: '''
    조항 상세 정보 테이블

    각 법령의 개별 조항에 대한 상세 정보를 저장합니다.

    Example Queries:
    ```sql
    -- 특정 법령의 모든 조항 조회
    SELECT a.* FROM articles a
    JOIN laws l ON a.law_id = l.law_id
    WHERE l.title = '공인중개사법' AND a.is_deleted = 0;

    -- 임차인 보호 조항 찾기
    SELECT a.*, l.title FROM articles a
    JOIN laws l ON a.law_id = l.law_id
    WHERE a.is_tenant_protection = 1;
    ```
  '''
}

// =============================================================================
// Table 3: legal_references - 법령 간 참조 관계
// =============================================================================
Table legal_references {
  reference_id integer [primary key, increment, note: '참조 고유 ID']
  source_article_id integer [not null, ref: > articles.article_id, note: '참조하는 조항 ID (외래키)']
  reference_type text [not null, note: '참조 유형 (law_references, decree_references, form_references)']
  target_law_title text [note: '참조 대상 법령명']
  target_article_number text [note: '참조 대상 조항']
  reference_text text [note: '원본 참조 텍스트']

  indexes {
    source_article_id [name: 'idx_references_source']
    reference_type [name: 'idx_references_type']
  }

  Note: '''
    법령 간 참조 관계 테이블

    조항 간의 참조 관계를 추적합니다.

    Reference Types:
    - law_references: 법률 참조
    - decree_references: 시행령 참조
    - form_references: 서식 참조

    Example Query:
    ```sql
    -- 특정 조항이 참조하는 모든 법령 찾기
    SELECT lr.*, l.title as source_law
    FROM legal_references lr
    JOIN articles a ON lr.source_article_id = a.article_id
    JOIN laws l ON a.law_id = l.law_id
    WHERE a.article_id = 123;
    ```
  '''
}

// =============================================================================
// Relationships (for visualization)
// =============================================================================
// Ref: laws.law_id < articles.law_id
// Ref: articles.article_id < legal_references.source_article_id
