# LLM í˜¸ì¶œ ë¡œì§ ë¶„ì„

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-02
**í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬**: "ì „ì„¸ ì¬ê³„ì•½í•´ì•¼í•´. ì „ì„¸ê¸ˆì€ ì–¼ë§ˆë‚˜ ì˜¬ë¦´ ìˆ˜ ìˆì§€? ì§€ê¸ˆ 5ì–µì´ì•¼."
**ì‹¤í–‰ ì‹œê°„**: 29.26ì´ˆ
**ì´ LLM í˜¸ì¶œ**: 4íšŒ

> **ì‹ ê·œ ì—…ë°ì´íŠ¸ (2025-10-02)**:
> - DocumentAgent, ReviewAgent ì¶”ê°€
> - ë²•ë¥  ê²€ìƒ‰ ê°œì„  (íŠ¹ì • ì¡°í•­ ê²€ìƒ‰ 100% ì„±ê³µë¥ )
> - SQL + ChromaDB í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ êµ¬í˜„

---

## ğŸ“Š ì „ì²´ íë¦„

```
ì‚¬ìš©ì ì§ˆë¬¸: "ì „ì„¸ ì¬ê³„ì•½í•´ì•¼í•´. ì „ì„¸ê¸ˆì€ ì–¼ë§ˆë‚˜ ì˜¬ë¦´ ìˆ˜ ìˆì§€? ì§€ê¸ˆ 5ì–µì´ì•¼."
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPERVISOR (supervisor.py)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1ï¸âƒ£ analyze_intent_node (Line 652-708)                  â”‚
â”‚    â†’ LLM í˜¸ì¶œ #1: analyze_intent()                     â”‚
â”‚    â†’ Input: query                                       â”‚
â”‚    â†’ Output: {intent_type, confidence, entities, ...}  â”‚
â”‚    â†’ ì†Œìš”ì‹œê°„: ~2.6ì´ˆ                                   â”‚
â”‚                                                          â”‚
â”‚ 2ï¸âƒ£ create_plan_node (Line 710-767)                     â”‚
â”‚    â†’ LLM í˜¸ì¶œ #2: create_execution_plan()              â”‚
â”‚    â†’ Input: query + intent                             â”‚
â”‚    â†’ Output: {agents, collection_keywords, reasoning}  â”‚
â”‚    â†’ ì†Œìš”ì‹œê°„: ~5.5ì´ˆ                                   â”‚
â”‚                                                          â”‚
â”‚ 3ï¸âƒ£ execute_agents_node (Line 769-893)                  â”‚
â”‚    â†’ SearchAgent ì‹¤í–‰ (LangGraph workflow)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEARCH AGENT (search_agent.py)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1ï¸âƒ£ create_search_plan_node (Line 265-330)              â”‚
â”‚    â†’ LLM í˜¸ì¶œ #3: create_search_plan()                 â”‚
â”‚    â†’ Input: query + keywords (from supervisor)         â”‚
â”‚    â†’ Output: {selected_tools, tool_parameters, ...}    â”‚
â”‚    â†’ ì†Œìš”ì‹œê°„: ~2.7ì´ˆ                                   â”‚
â”‚                                                          â”‚
â”‚ 2ï¸âƒ£ execute_tools_node (Line 332-448)                   â”‚
â”‚    â†’ LegalSearchTool.execute()                         â”‚
â”‚    â†’ ì‹¤ì œ DB ê²€ìƒ‰ (ChromaDB + Embedding)               â”‚
â”‚    â†’ ì†Œìš”ì‹œê°„: ~0.5ì´ˆ (ë²¡í„° ê²€ìƒ‰)                       â”‚
â”‚                                                          â”‚
â”‚ 3ï¸âƒ£ process_results_node (Line 450-514)                 â”‚
â”‚    â†’ collected_data ìƒì„±                                â”‚
â”‚                                                          â”‚
â”‚ 4ï¸âƒ£ decide_next_action_node (Line 516-583)              â”‚
â”‚    â†’ LLM í˜¸ì¶œ #4: decide_next_action()                 â”‚
â”‚    â†’ Input: collected_data + query                     â”‚
â”‚    â†’ Output: {next_action, reasoning, summary}         â”‚
â”‚    â†’ ì†Œìš”ì‹œê°„: ~2.3ì´ˆ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPERVISOR (ê³„ì†)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4ï¸âƒ£ generate_response_node (Line 895-1003)              â”‚
â”‚    â†’ LLM í˜¸ì¶œ ì—†ìŒ                                      â”‚
â”‚    â†’ agent_resultsë¥¼ final_responseë¡œ í¬ë§·íŒ…           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¢ LLM í˜¸ì¶œ ìƒì„¸

### Supervisor: 2ë²ˆ í˜¸ì¶œ (ì´ ~8ì´ˆ)

#### LLM í˜¸ì¶œ #1: `analyze_intent()` - Intent ë¶„ë¥˜ + ì˜ë„ ë¶„ì„
**ìœ„ì¹˜**: `supervisor.py:652-708` â†’ `analyze_intent_node`
**í˜¸ì¶œ ë©”ì„œë“œ**: `supervisor.py:241-394` â†’ `async def analyze_intent()`
**ì†Œìš”ì‹œê°„**: ~2.6ì´ˆ (2ë‹¨ê³„ LLM í˜¸ì¶œ)

**í”„ë¡¬í”„íŠ¸ Stage 1 - ì„œë¹„ìŠ¤ ê´€ë ¨ì„± íŒë‹¨**:
```python
system_prompt = """ë‹¹ì‹ ì€ ë¶€ë™ì‚° ì „ë¬¸ ì±—ë´‡ ì„œë¹„ìŠ¤ì˜ ê´€ë ¨ì„± ë¶„ë¥˜ê¸°ì…ë‹ˆë‹¤.

ì´ ì±—ë´‡ì˜ ì„œë¹„ìŠ¤ ë²”ìœ„:
1. ë¶€ë™ì‚° ë§¤ë§¤/ì „ì„¸/ì›”ì„¸ ì •ë³´ ì œê³µ
2. ë¶€ë™ì‚° ì‹œì„¸ ë° ì‹œì¥ ë¶„ì„
3. ë¶€ë™ì‚° ê´€ë ¨ ë²•ë¥  ë° ê³„ì•½ ì•ˆë‚´
4. ë¶€ë™ì‚° ëŒ€ì¶œ ë° ê¸ˆìœµ ì •ë³´
5. ë¶€ë™ì‚° íˆ¬ì ë° ê°œë°œ ì •ë³´
6. ê±´ì¶• ê·œì œ ë° ì¸í—ˆê°€ ì •ë³´
7. ë¶€ë™ì‚° ì„¸ê¸ˆ ë° ê³µê³¼ê¸ˆ ì•ˆë‚´

ì„œë¹„ìŠ¤ ë²”ìœ„ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ê²ƒ:
- ì¼ë°˜ì ì¸ ì¸ì‚¬, ê°ì • í‘œí˜„, ìš•ì„¤
- ë¶€ë™ì‚°ê³¼ ë¬´ê´€í•œ ì¼ë°˜ ì§€ì‹ ì§ˆë¬¸
- ë‹¤ë¥¸ ì‚°ì—…ì´ë‚˜ ì£¼ì œì— ëŒ€í•œ ì§ˆì˜
- ì˜ë¯¸ì—†ëŠ” í…ìŠ¤íŠ¸ë‚˜ ë¬´ì‘ìœ„ ë‹¨ì–´
- ê°œì¸ ì •ë³´ë‚˜ ìê¸°ì†Œê°œ (ì˜ˆ: "ë‚´ ì´ë¦„ì€ ~ì•¼", "ë‚˜ëŠ” ~ë‹¤")

ì¤‘ìš”: ë¬¸ë§¥ì„ ìš°ì„ ì ìœ¼ë¡œ íŒë‹¨í•˜ì„¸ìš”!
- ë¶€ë™ì‚° ê´€ë ¨ í‚¤ì›Œë“œê°€ ìˆì–´ë„ ì „ì²´ ë¬¸ë§¥ì´ ë¶€ë™ì‚°ê³¼ ë¬´ê´€í•˜ë©´ falseë¡œ ë¶„ë¥˜
- ì˜ˆì‹œ: "ë‚´ ì´ë¦„ì€ ì–‘ë„ì„¸ì•¼" â†’ false (ê°œì¸ ì†Œê°œ, ë¶€ë™ì‚°ê³¼ ë¬´ê´€)
- ì˜ˆì‹œ: "ì–‘ë„ì„¸ê°€ ë­ì•¼?" â†’ true (ë¶€ë™ì‚° ì„¸ê¸ˆ ê´€ë ¨ ì§ˆë¬¸)

ì§ˆì˜ê°€ ë¶€ë™ì‚° ì„œë¹„ìŠ¤ì™€ ê´€ë ¨ì´ ìˆëŠ”ì§€ íŒë‹¨í•˜ì„¸ìš”.
ê²½ê³„ì„ ì— ìˆëŠ” ê²½ìš°(ì˜ˆ: ì¼ë°˜ ê¸ˆìœµì´ì§€ë§Œ ë¶€ë™ì‚° ëŒ€ì¶œì¼ ìˆ˜ë„ ìˆëŠ” ê²½ìš°) trueë¡œ ë¶„ë¥˜í•˜ì„¸ìš”.

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ:
{
    "is_relevant": true/false,
    "confidence": 0.0-1.0,
    "reasoning": "íŒë‹¨ ê·¼ê±°"
}"""

user_prompt = f"ì‚¬ìš©ì ì§ˆì˜: {query}"
```

**Stage 1 ë°˜í™˜ê°’**:
```json
{
  "is_relevant": true,
  "confidence": 0.95,
  "reasoning": "ì „ì„¸ ì¬ê³„ì•½ ë° ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„ëŠ” ë¶€ë™ì‚° ì„ëŒ€ì°¨ ê³„ì•½ ê´€ë ¨ ì§ˆë¬¸ì…ë‹ˆë‹¤."
}
```

**í”„ë¡¬í”„íŠ¸ Stage 2 - ì˜ë„ ìƒì„¸ ë¶„ì„**:
```python
system_prompt = """ë‹¹ì‹ ì€ ë¶€ë™ì‚° ì „ë¬¸ ì±—ë´‡ì˜ ì˜ë„ ë¶„ì„ê¸°ì…ë‹ˆë‹¤.
ì‚¬ìš©ì ì§ˆì˜ë¥¼ ë¶„ì„í•˜ì—¬ êµ¬ì²´ì ì¸ ì˜ë„ì™€ í•µì‹¬ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš”.

ì˜ë„ íƒ€ì…:
- search: ë§¤ë¬¼/ì‹œì„¸ ê²€ìƒ‰
- analysis: ì‹œì¥ ë¶„ì„
- recommendation: ì¶”ì²œ ìš”ì²­
- legal: ë²•ë¥ /ê·œì • ê´€ë ¨
- loan: ëŒ€ì¶œ ê´€ë ¨
- general: ì¼ë°˜ ë¬¸ì˜
- unclear: ì˜ë„ê°€ ë¶ˆëª…í™•

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
    "intent_type": "ì˜ë„ íƒ€ì…",
    "entities": {
        "region": "ì§€ì—­ëª…",
        "property_type": "ë¶€ë™ì‚° ìœ í˜•",
        "transaction_type": "ê±°ë˜ ìœ í˜•"
    },
    "keywords": ["í•µì‹¬ í‚¤ì›Œë“œ"],
    "confidence": 0.0-1.0
}"""

user_prompt = f"ì‚¬ìš©ì ì§ˆì˜: {query}"
```

**Stage 2 ë°˜í™˜ê°’**:
```json
{
  "intent_type": "legal",
  "entities": {
    "region": null,
    "property_type": "ì „ì„¸",
    "transaction_type": "ì¬ê³„ì•½"
  },
  "keywords": ["ì „ì„¸ê¸ˆ", "ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ê¸ˆì•¡", "ì¬ê³„ì•½"],
  "confidence": 0.85,
  "is_real_estate_related": true
}
```

**ëª©ì **:
1. ë¶€ë™ì‚° ê´€ë ¨ ì§ˆë¬¸ì¸ì§€ í•„í„°ë§ (is_relevant)
2. ì§ˆë¬¸ì˜ ì˜ë„ íŒŒì•… ë° ì—”í‹°í‹° ì¶”ì¶œ

---

#### LLM í˜¸ì¶œ #2: `create_execution_plan()` - ì—ì´ì „íŠ¸ ì„ íƒ ë° í‚¤ì›Œë“œ ìƒì„±
**ìœ„ì¹˜**: `supervisor.py:710-767` â†’ `create_plan_node`
**í˜¸ì¶œ ë©”ì„œë“œ**: `supervisor.py:395-543` â†’ `async def create_execution_plan()`
**ì†Œìš”ì‹œê°„**: ~5.5ì´ˆ

**í”„ë¡¬í”„íŠ¸**:
```python
system_prompt = """ë‹¹ì‹ ì€ ë¶€ë™ì‚° ì±—ë´‡ì˜ ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì‚¬ìš©ì ì˜ë„ì— ë”°ë¼ ê°€ì¥ ì í•©í•œ ì—ì´ì „íŠ¸ë¥¼ ì„ íƒí•˜ê³  ì‹¤í–‰ ê³„íšì„ ìˆ˜ë¦½í•˜ì„¸ìš”.

## ì—ì´ì „íŠ¸ ìƒì„¸ ëª…ì„¸

### 1. search_agent (ê²€ìƒ‰ ì—ì´ì „íŠ¸) - [êµ¬í˜„ ì™„ë£Œ]
- **ëª©ì **: ë¶€ë™ì‚° ê´€ë ¨ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê³  ìˆ˜ì§‘í•˜ëŠ” ì „ë¬¸ Agent
- **ê¸°ëŠ¥(Capabilities)**:
  â€¢ ë¶€ë™ì‚° ë§¤ë¬¼ ì •ë³´ ê²€ìƒ‰
  â€¢ ì‹œì„¸ ì •ë³´ ì¡°íšŒ
  â€¢ ë²•ë¥  ë° ê·œì • ê²€ìƒ‰
  â€¢ ëŒ€ì¶œ ìƒí’ˆ ì •ë³´ ìˆ˜ì§‘
  â€¢ ì—¬ëŸ¬ ë°ì´í„° ì†ŒìŠ¤ ë³‘ë ¬ ê²€ìƒ‰
  â€¢ ê²€ìƒ‰ ê²°ê³¼ êµ¬ì¡°í™” ë° ìš”ì•½
- **í•œê³„(Limitations)**:
  â€¢ ë°ì´í„° ë¶„ì„ì´ë‚˜ ì¸ì‚¬ì´íŠ¸ ë„ì¶œ ë¶ˆê°€
  â€¢ ì¶”ì²œ ë¡œì§ ìˆ˜í–‰ ë¶ˆê°€
  â€¢ ë³µì¡í•œ ê³„ì‚°ì´ë‚˜ ì˜ˆì¸¡ ë¶ˆê°€
- **ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬**:
  â€¢ legal_search: ë¶€ë™ì‚° ë²•ë¥  ì •ë³´ ê²€ìƒ‰
  â€¢ regulation_search: ë¶€ë™ì‚° ê·œì • ë° ì •ì±… ê²€ìƒ‰
  â€¢ loan_search: ë¶€ë™ì‚° ëŒ€ì¶œ ìƒí’ˆ ê²€ìƒ‰
  â€¢ real_estate_search: ë¶€ë™ì‚° ë§¤ë¬¼ ë° ì‹œì„¸ ê²€ìƒ‰
- **ì í•©í•œ ì‚¬ìš© ì¼€ì´ìŠ¤**:
  â€¢ ë¶€ë™ì‚° ë§¤ë¬¼ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš°
  â€¢ ì‹œì„¸ ì¡°íšŒê°€ í•„ìš”í•œ ê²½ìš°
  â€¢ ë²•ë¥ /ê·œì • ì •ë³´ ê²€ìƒ‰ì´ í•„ìš”í•œ ê²½ìš°
  â€¢ ëŒ€ì¶œ ì •ë³´ ìˆ˜ì§‘ì´ í•„ìš”í•œ ê²½ìš°
  â€¢ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ì •ë³´ë¥¼ ë™ì‹œì— ìˆ˜ì§‘í•´ì•¼ í•˜ëŠ” ê²½ìš°

### 2. analysis_agent (ë¶„ì„ ì—ì´ì „íŠ¸) - [êµ¬í˜„ ì™„ë£Œ]
- **ëª©ì **: ìˆ˜ì§‘ëœ ë¶€ë™ì‚° ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•˜ëŠ” ì „ë¬¸ Agent
- **ê¸°ëŠ¥(Capabilities)**:
  â€¢ ì‹œì¥ í˜„í™© ë¶„ì„ (ê°€ê²©, ê±°ë˜ëŸ‰, ìˆ˜ê¸‰)
  â€¢ ê°€ê²© íŠ¸ë Œë“œ ë° íŒ¨í„´ ë¶„ì„
  â€¢ ì§€ì—­ë³„/ë‹¨ì§€ë³„ ë¹„êµ ë¶„ì„
  â€¢ íˆ¬ì ê°€ì¹˜ í‰ê°€ (ROI, ìˆ˜ìµë¥ )
  â€¢ ë¦¬ìŠ¤í¬ ìš”ì¸ ì‹ë³„ ë° í‰ê°€
  â€¢ ë°ì´í„° ê¸°ë°˜ ì¶”ì²œì‚¬í•­ ì œê³µ
  â€¢ ë¶„ì„ ê²°ê³¼ ì‹œê°í™” ë°ì´í„° ì¤€ë¹„
- **ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬**:
  â€¢ market_analyzer: ì‹œì¥ í˜„í™© ë¶„ì„
  â€¢ trend_analyzer: ê°€ê²© íŠ¸ë Œë“œ ë¶„ì„
  â€¢ comparative_analyzer: ì§€ì—­ë³„ ë¹„êµ
  â€¢ investment_evaluator: íˆ¬ì ê°€ì¹˜ í‰ê°€
  â€¢ risk_assessor: ë¦¬ìŠ¤í¬ í‰ê°€

## ì—ì´ì „íŠ¸ ì„ íƒ ê¸°ì¤€

1. **ê²€ìƒ‰/ìˆ˜ì§‘ì´ í•„ìš”í•œ ê²½ìš°** â†’ search_agent ì„ íƒ
   - í‚¤ì›Œë“œ: ê²€ìƒ‰, ì¡°íšŒ, ì°¾ê¸°, ì•Œë ¤ì¤˜, ì •ë³´, ì‹œì„¸, ë§¤ë¬¼, ë²•ë¥ , ëŒ€ì¶œ

2. **ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš°** â†’ analysis_agent ì„ íƒ
   - í‚¤ì›Œë“œ: ë¶„ì„, ë¹„êµ, í‰ê°€, íŠ¸ë Œë“œ, ë™í–¥, ì „ë§, ì‹œì¥, íˆ¬ì, ë¦¬ìŠ¤í¬

3. **ì¶”ì²œì´ í•„ìš”í•œ ê²½ìš°** â†’ recommendation_agent ì„ íƒ (ë¯¸êµ¬í˜„ ì‹œ search_agent ì‚¬ìš©)
   - í‚¤ì›Œë“œ: ì¶”ì²œ, ì œì•ˆ, ì–´ë–¤ê²Œ ì¢‹ì„ê¹Œ, ì í•©í•œ, ë§ì¶¤

### 3. document_agent (ë¬¸ì„œ ìƒì„± ì—ì´ì „íŠ¸) - [êµ¬í˜„ ì™„ë£Œ] ğŸ†•
- **ëª©ì **: ë¶€ë™ì‚° ê´€ë ¨ ë²•ë¥  ë¬¸ì„œë¥¼ ìƒì„±í•˜ëŠ” ì „ë¬¸ Agent
- **ê¸°ëŠ¥(Capabilities)**:
  â€¢ ì„ëŒ€ì°¨ê³„ì•½ì„œ, ë§¤ë§¤ê³„ì•½ì„œ, ì „ì„¸ê³„ì•½ì„œ ìƒì„±
  â€¢ ë‚´ìš©ì¦ëª…, ê³„ì•½í•´ì§€í†µì§€ì„œ ì‘ì„±
  â€¢ ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì› (TEXT, HTML, JSON, DOCX, PDF)
- **ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬**:
  â€¢ document_generation: ë¬¸ì„œ ìƒì„± ë„êµ¬ (Mock í…œí”Œë¦¿)
- **ì í•©í•œ ì‚¬ìš© ì¼€ì´ìŠ¤**:
  â€¢ ê³„ì•½ì„œ ì´ˆì•ˆ ì‘ì„±ì´ í•„ìš”í•œ ê²½ìš°
  â€¢ ë²•ë¥  ë¬¸ì„œ í…œí”Œë¦¿ì´ í•„ìš”í•œ ê²½ìš°

### 4. review_agent (ê³„ì•½ ê²€í†  ì—ì´ì „íŠ¸) - [êµ¬í˜„ ì™„ë£Œ] ğŸ†•
- **ëª©ì **: ë¶€ë™ì‚° ê³„ì•½ì„œ ë° ë¬¸ì„œë¥¼ ê²€í† í•˜ê³  ìœ„í—˜ì„ ë¶„ì„í•˜ëŠ” ì „ë¬¸ Agent
- **ê¸°ëŠ¥(Capabilities)**:
  â€¢ ê³„ì•½ì„œ ìœ„í—˜ ìš”ì†Œ ë¶„ì„
  â€¢ ë²•ì  ì¤€ìˆ˜ì‚¬í•­ í™•ì¸
  â€¢ ë¬¸ì„œ ì™„ì„±ë„ í‰ê°€
  â€¢ ë¦¬ìŠ¤í¬ ë ˆë²¨ í‰ê°€ (low/medium/high/critical)
- **ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬**:
  â€¢ contract_review: ê³„ì•½ì„œ ê²€í†  ë„êµ¬ (ê·œì¹™ ê¸°ë°˜)
- **ì í•©í•œ ì‚¬ìš© ì¼€ì´ìŠ¤**:
  â€¢ ê³„ì•½ì„œ ê²€í† ê°€ í•„ìš”í•œ ê²½ìš°
  â€¢ ìœ„í—˜ ìš”ì†Œ íŒŒì•…ì´ í•„ìš”í•œ ê²½ìš°

## ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ ì§€ì¹¨

1. ì‚¬ìš©ì ì˜ë„ë¥¼ ì •í™•íˆ íŒŒì•…
2. í•„ìš”í•œ ì‘ì—…ì„ ë‹¨ê³„ë³„ë¡œ ë¶„í•´
3. ê° ë‹¨ê³„ì— ì í•©í•œ ì—ì´ì „íŠ¸ ì„ íƒ
4. ì—ì´ì „íŠ¸ ê°„ ë°ì´í„° íë¦„ ê³ ë ¤
5. í˜„ì¬ êµ¬í˜„ëœ ì—ì´ì „íŠ¸ë§Œ ì„ íƒ (search_agent, analysis_agent, document_agent, review_agent ì‚¬ìš© ê°€ëŠ¥)

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
    "agents": ["ì„ íƒëœ ì—ì´ì „íŠ¸ ëª©ë¡"],
    "collection_keywords": ["ìˆ˜ì§‘í•  í‚¤ì›Œë“œ"],
    "execution_order": "sequential ë˜ëŠ” parallel",
    "reasoning": "ê³„íš ìˆ˜ë¦½ ê·¼ê±°",
    "agent_capabilities_used": ["ì‚¬ìš©í•  ì—ì´ì „íŠ¸ ê¸°ëŠ¥ ëª©ë¡"]
}"""

user_prompt = f"""ì‚¬ìš©ì ì§ˆì˜: {query}
ë¶„ì„ëœ ì˜ë„: {intent}"""
```

**ë°˜í™˜ê°’**:
```json
{
  "agents": ["search_agent"],
  "collection_keywords": ["ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„", "ì „ì„¸ ì¬ê³„ì•½ ë²•ë¥ ", "ì „ì„¸ê¸ˆ ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ê¸ˆì•¡"],
  "execution_order": "sequential",
  "reasoning": "ì „ì„¸ ì¬ê³„ì•½ ì‹œ ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„ì— ëŒ€í•œ ë²•ë¥  ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì œê³µí•´ì•¼ í•˜ë¯€ë¡œ search_agentë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.",
  "agent_capabilities_used": ["ë²•ë¥  ë° ê·œì • ê²€ìƒ‰", "ê²€ìƒ‰ ê²°ê³¼ êµ¬ì¡°í™” ë° ìš”ì•½"]
}
```

**ëª©ì **:
1. ì–´ë–¤ ì—ì´ì „íŠ¸ë¥¼ ì‚¬ìš©í• ì§€ ê²°ì •
2. ì—ì´ì „íŠ¸ì— ì „ë‹¬í•  ê²€ìƒ‰ í‚¤ì›Œë“œ ìƒì„±

---

### SearchAgent: 2ë²ˆ í˜¸ì¶œ (ì´ ~5ì´ˆ)

#### LLM í˜¸ì¶œ #3: `create_search_plan()` - ê²€ìƒ‰ ë„êµ¬ ì„ íƒ ë° íŒŒë¼ë¯¸í„° ìƒì„±
**ìœ„ì¹˜**: `search_agent.py:265-330` â†’ `create_search_plan_node`
**í˜¸ì¶œ ë©”ì„œë“œ**: `search_agent.py:107-175` â†’ `async def create_search_plan()`
**ì†Œìš”ì‹œê°„**: ~2.7ì´ˆ

**í”„ë¡¬í”„íŠ¸ (ìˆ˜ì • í›„ - 2025-10-01 17:51 ì ìš©)**:
```python
system_prompt = """ë‹¹ì‹ ì€ ë¶€ë™ì‚° ì •ë³´ ê²€ìƒ‰ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì£¼ì–´ì§„ í‚¤ì›Œë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì ì ˆí•œ ê²€ìƒ‰ ë„êµ¬ë¥¼ ì„ íƒí•˜ê³  ê²€ìƒ‰ ê³„íšì„ ìˆ˜ë¦½í•˜ì„¸ìš”.

ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬:
- legal_search: ë²•ë¥ , ê³„ì•½, ì„¸ê¸ˆ ì •ë³´ (ChromaDB ë²¡í„° ê²€ìƒ‰ + ë©”íƒ€ë°ì´í„° í•„í„°ë§)
  * ì§€ì› í•„í„°: doc_type (ë²•ë¥ /ì‹œí–‰ë ¹/ì‹œí–‰ê·œì¹™/ëŒ€ë²•ì›ê·œì¹™/ìš©ì–´ì§‘/ê¸°íƒ€)
  * ì§€ì› í•„í„°: category (1_ê³µí†µ ë§¤ë§¤_ì„ëŒ€ì°¨, 2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸, 3_ê³µê¸‰_ë°_ê´€ë¦¬_ë§¤ë§¤_ë¶„ì–‘, 4_ê¸°íƒ€)
  * ì§€ì› í•„í„°: is_tenant_protection (ì„ì°¨ì¸ ë³´í˜¸ ì¡°í•­)
  * ì§€ì› í•„í„°: is_tax_related (ì„¸ê¸ˆ ê´€ë ¨ ì¡°í•­)
- regulation_search: ê·œì •, ì •ì±…, ê±´ì¶• ê·œì œ
- loan_search: ëŒ€ì¶œ, ê¸ˆë¦¬, ê¸ˆìœµ ìƒí’ˆ
- real_estate_search: ë§¤ë¬¼, ì‹œì„¸, ê±°ë˜ ì •ë³´

âš ï¸ legal_search í•„í„° ì‚¬ìš© ê°€ì´ë“œ:
ã€doc_type í•„í„° - ë§¤ìš° ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©ã€‘
  â€¢ doc_typeì€ ì‚¬ìš©ìê°€ "ì‹œí–‰ë ¹", "ì‹œí–‰ê·œì¹™", "ëŒ€ë²•ì›ê·œì¹™" ë“±ì„ ëª…ì‹œì ìœ¼ë¡œ ì–¸ê¸‰í•œ ê²½ìš°ë§Œ ì‚¬ìš©
  â€¢ "ë²•ë¥ ", "ë²•", "ë²•ë ¹" ê°™ì€ ì¼ë°˜ì ì¸ ë‹¨ì–´ëŠ” doc_type ì§€ì • ê¸ˆì§€ (ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ìë™ ì²˜ë¦¬ë¨)
  â€¢ "ê¸°íƒ€"ëŠ” ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€ (ì „ì²´ ë°ì´í„°ì˜ 1.4%ë§Œ í•´ë‹¹)
  â€¢ ë¶ˆí™•ì‹¤í•˜ë©´ doc_typeì„ ìƒëµ â†’ ì „ì²´ ë¬¸ì„œì—ì„œ ë²¡í„° ê²€ìƒ‰ ìˆ˜í–‰ (ê¶Œì¥)

ã€category í•„í„° - ì ê·¹ í™œìš© ê¶Œì¥ã€‘
  â€¢ "ì„ëŒ€ì°¨", "ì „ì„¸", "ì›”ì„¸" â†’ category="2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸"
  â€¢ "ë§¤ë§¤", "ë¶„ì–‘", "ê³µê¸‰" â†’ category="3_ê³µê¸‰_ë°_ê´€ë¦¬_ë§¤ë§¤_ë¶„ì–‘"
  â€¢ categoryëŠ” doc_typeë³´ë‹¤ ì•ˆì „í•˜ê³  íš¨ê³¼ì 

ë²•ë¥  ê²€ìƒ‰ ì˜ˆì‹œ:
- "ì „ì„¸ê¸ˆ ì¸ìƒ ë²•ë¥ " â†’ legal_search (doc_type ì—†ìŒ, category="2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸")
- "ì„ëŒ€ì°¨ ê³„ì•½ ë³´ì¦ê¸ˆ" â†’ legal_search (doc_type ì—†ìŒ, category="2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸")
- "ê³µì¸ì¤‘ê°œì‚¬ë²• ì‹œí–‰ë ¹" â†’ legal_search with doc_type="ì‹œí–‰ë ¹" (ëª…ì‹œì ìœ¼ë¡œ "ì‹œí–‰ë ¹" ì–¸ê¸‰)
- "ì„ì°¨ì¸ ë³´í˜¸ ì¡°í•­" â†’ legal_search with is_tenant_protection=true
- "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²•" â†’ legal_search (doc_type ì—†ìŒ, ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ìë™ ë§¤ì¹­)

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ:
{
    "selected_tools": ["ë„êµ¬1", "ë„êµ¬2"],
    "tool_parameters": {
        "ë„êµ¬1": {
            "query": "ê²€ìƒ‰ ì¿¼ë¦¬",
            "category": "ì¹´í…Œê³ ë¦¬ (ê¶Œì¥)"
        },
        "ë„êµ¬2": {"param1": "value1"}
    },
    "search_strategy": "ê²€ìƒ‰ ì „ëµ ì„¤ëª…"
}"""

user_prompt = f"""ì‚¬ìš©ì ì§ˆì˜: {query}
ìˆ˜ì§‘ í‚¤ì›Œë“œ: {', '.join(keywords)}"""
```

**ë°˜í™˜ê°’ (ì‹¤ì œ ë¡œê·¸)**:
```json
{
  "selected_tools": ["legal_search"],
  "tool_parameters": {
    "legal_search": {
      "query": "ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„",
      "category": "2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸",
      "limit": 10
    }
  },
  "search_strategy": "ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„ì— ëŒ€í•œ ë²•ë¥  ì •ë³´ë¥¼ ì°¾ê¸° ìœ„í•´ legal_search ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ ë²•ë¥  ë¬¸ì„œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤. 'ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„'ë¼ëŠ” í‚¤ì›Œë“œë¥¼ í†µí•´ ì „ì„¸ ì¬ê³„ì•½ ì‹œ ì¸ìƒ..."
}
```

**ì‹¤ì œ ì‹¤í–‰ëœ ê²€ìƒ‰**:
```python
# ë¡œê·¸: 2025-10-01 17:52:23
Searching legal DB - query: ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„, doc_type: None, category: 2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸
Filter dict: {'is_deleted': False}
```

**ì£¼ìš” ê°œì„ ì  (2025-10-01 ì ìš©)**:
- âœ… `doc_type: None` - ê³¼ë„í•œ í•„í„°ë§ ë°©ì§€ (ì´ì „: `doc_type: "ê¸°íƒ€"` â†’ 0 results)
- âœ… `category: "2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸"` - ì ì ˆí•œ ì¹´í…Œê³ ë¦¬ í•„í„° ì‚¬ìš©
- âœ… 10ê°œ ê²°ê³¼ ë°˜í™˜ (ì´ì „: 0ê°œ)

**ëª©ì **:
1. ì–´ë–¤ Toolì„ ì‚¬ìš©í• ì§€ ì„ íƒ
2. Tool íŒŒë¼ë¯¸í„° ìƒì„± (í•„í„°ë§ ì¡°ê±´ í¬í•¨)

---

#### LLM í˜¸ì¶œ #4: `decide_next_action()` - ê²€ìƒ‰ ê²°ê³¼ í‰ê°€ ë° ë‹¤ìŒ ì•¡ì…˜ ê²°ì •
**ìœ„ì¹˜**: `search_agent.py:516-583` â†’ `decide_next_action_node`
**í˜¸ì¶œ ë©”ì„œë“œ**: `search_agent.py:177-228` â†’ `async def decide_next_action()`
**ì†Œìš”ì‹œê°„**: ~2.3ì´ˆ

**í”„ë¡¬í”„íŠ¸**:
```python
system_prompt = """ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ë‹¤ìŒ í–‰ë™ì„ ê²°ì •í•˜ì„¸ìš”.

ê°€ëŠ¥í•œ í–‰ë™:
- return_to_supervisor: ê°ë…ìì—ê²Œ ê²°ê³¼ ë°˜í™˜
- pass_to_agent: ë‹¤ë¥¸ ì—ì´ì „íŠ¸ì—ê²Œ ì „ë‹¬ (target_agent ì§€ì •)
- direct_output: ì‚¬ìš©ìì—ê²Œ ì§ì ‘ ì¶œë ¥

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ:
{
    "next_action": "ì„ íƒí•œ í–‰ë™",
    "target_agent": "ëŒ€ìƒ ì—ì´ì „íŠ¸ (pass_to_agentì¸ ê²½ìš°)",
    "reasoning": "ê²°ì • ì´ìœ ",
    "summary": "ë°ì´í„° ìš”ì•½"
}"""

user_prompt = f"""ì›ë³¸ ì§ˆì˜: {query}
ìˆ˜ì§‘ëœ ë°ì´í„° ê°œìˆ˜: {len(collected_data)}
ë°ì´í„° ì¹´í…Œê³ ë¦¬: {list(collected_data.keys())}"""
```

**ë°˜í™˜ê°’**:
```json
{
  "next_action": "return_to_supervisor",
  "target_agent": null,
  "reasoning": "ì „ì„¸ ì¬ê³„ì•½ ì‹œ ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„ì— ëŒ€í•œ ë²•ë¥  ì •ë³´ê°€ ì¶©ë¶„íˆ ìˆ˜ì§‘ë˜ì—ˆìœ¼ë¯€ë¡œ ê°ë…ìì—ê²Œ ë°˜í™˜í•©ë‹ˆë‹¤.",
  "summary": "ì „ì„¸ ì¬ê³„ì•½ ì‹œ 5ì–µ ì›ì˜ ì „ì„¸ê¸ˆ ì¸ìƒ ê°€ëŠ¥ì„±ì— ëŒ€í•œ ë²•ì  ê¸°ì¤€ì„ ì¡°ì‚¬í•œ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**ëª©ì **:
1. ê²€ìƒ‰ ê²°ê³¼ê°€ ì¶©ë¶„í•œì§€ íŒë‹¨
2. ì¶”ê°€ ì—ì´ì „íŠ¸ í˜¸ì¶œ í•„ìš” ì—¬ë¶€ ê²°ì •

---

## ğŸ” ê²€ìƒ‰ ê²°ê³¼ ìƒì„¸ (ChromaDB + Embedding)

### ê²€ìƒ‰ ì‹¤í–‰ ì •ë³´
- **ê²€ìƒ‰ ì—”ì§„**: ChromaDB (ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰)
- **ì„ë² ë”© ëª¨ë¸**: kure_v1 (Korean Legal Embedding, 1024D)
- **ì´ ë¬¸ì„œ ìˆ˜**: 1,700ê°œ
- **ê²€ìƒ‰ ì†Œìš”ì‹œê°„**: ~0.5ì´ˆ

### í•„í„° ì ìš©
```python
Filter: {'is_deleted': False}
Category: 2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸
```

### ë°˜í™˜ëœ ë²•ë¥  ë¬¸ì„œ (Top 10, ê´€ë ¨ë„ ìˆœ)

| # | Doc Type | ë²•ë¥ ëª… | ì¡°í•­ | ì œëª© | ê´€ë ¨ë„ |
|---|----------|--------|------|------|--------|
| 1 | ë²•ë¥  | ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• | ì œ7ì¡° | ì°¨ì„ ë“±ì˜ ì¦ê°ì²­êµ¬ê¶Œ | 0.175 |
| 2 | ì‹œí–‰ë ¹ | ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì‹œí–‰ë ¹ | ì œ10ì¡° | ë³´ì¦ê¸ˆ ì¤‘ ì¼ì •ì•¡ì˜ ë²”ìœ„ ë“± | 0.166 |
| 3 | ë²•ë¥  | ë¶€ë™ì‚°ë“±ê¸°ë²• | ì œ73ì¡° | ì „ì„¸ê¸ˆë°˜í™˜ì±„ê¶Œì˜ ì¼ë¶€ì–‘ë„ì— ë”°ë¥¸ ì „ì„¸ê¶Œ ì¼ë¶€ì´ì „ë“±ê¸° | 0.144 |
| 4 | ì‹œí–‰ë ¹ | ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì‹œí–‰ë ¹ | **ì œ8ì¡°** | **ì°¨ì„ ë“± ì¦ì•¡ì²­êµ¬ì˜ ê¸°ì¤€ ë“± (5% í•œë„!)** | 0.102 |
| 5 | ì‹œí–‰ê·œì¹™ | ê³µì¸ì¤‘ê°œì‚¬ë²• ì‹œí–‰ê·œì¹™ | ì œ20ì¡° | ì¤‘ê°œë³´ìˆ˜ ë° ì‹¤ë¹„ì˜ í•œë„ ë“± | 0.102 |
| 6 | ì‹œí–‰ë ¹ | ë¯¼ê°„ì„ëŒ€ì£¼íƒë²• ì‹œí–‰ë ¹ | ì œ34ì¡°ì˜2 | ì„ëŒ€ë£Œ | 0.101 |
| 7 | ë²•ë¥  | ë¯¼ê°„ì„ëŒ€ì£¼íƒë²• | ì œ44ì¡°ì˜2 | ì´ˆê³¼ ì„ëŒ€ë£Œì˜ ë°˜í™˜ ì²­êµ¬ | 0.095 |
| 8 | ë²•ë¥  | ë¯¼ê°„ì„ëŒ€ì£¼íƒë²• | ì œ63ì¡° | ê°€ì‚°ê¸ˆë¦¬ | 0.081 |
| 9 | ì‹œí–‰ë ¹ | ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì‹œí–‰ë ¹ | ì œ11ì¡° | ìš°ì„ ë³€ì œë¥¼ ë°›ì„ ì„ì°¨ì¸ì˜ ë²”ìœ„ | 0.074 |
| 10 | ë²•ë¥  | ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• | ì œ10ì¡°ì˜2 | ì´ˆê³¼ ì°¨ì„ ë“±ì˜ ë°˜í™˜ì²­êµ¬ | 0.071 |

### í•µì‹¬ ë²•ë¥  ì •ë³´ (ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‹µ)

**ì§ˆë¬¸**: "ì „ì„¸ê¸ˆì€ ì–¼ë§ˆë‚˜ ì˜¬ë¦´ ìˆ˜ ìˆì§€? ì§€ê¸ˆ 5ì–µì´ì•¼."

**ë‹µë³€ ê·¼ê±° ë²•ë¥ **:
- **ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì‹œí–‰ë ¹ ì œ8ì¡°** (ê´€ë ¨ë„ 0.102)
  - ë‚´ìš©: "ì°¨ì„ë“±ì˜ ì¦ì•¡ì²­êµ¬ëŠ” ì•½ì •í•œ ì°¨ì„ë“±ì˜ **20ë¶„ì˜ 1ì˜ ê¸ˆì•¡ì„ ì´ˆê³¼í•˜ì§€ ëª»í•œë‹¤**"
  - í•´ì„: **5% í•œë„** (5ì–µ Ã— 5% = 2,500ë§Œì›ê¹Œì§€ ì¸ìƒ ê°€ëŠ¥)

---

## ğŸ”§ Toolì—ì„œì˜ LLM í˜¸ì¶œ ì—¬ë¶€

### ê²°ë¡ : Toolì€ LLMì„ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ âœ…

ëª¨ë“  Toolì„ ê²€ì¦í•œ ê²°ê³¼, **ì–´ë–¤ Toolë„ LLM(GPT)ì„ í˜¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.

### Toolë³„ ë™ì‘ ë°©ì‹

#### 1. legal_search_tool.py (ì‹¤ì œ DB ì‚¬ìš©)
**ë™ì‘**:
- ChromaDB ë²¡í„° ê²€ìƒ‰ (ì„ë² ë”© ìœ ì‚¬ë„ ë¹„êµ)
- SQL ë©”íƒ€ë°ì´í„° ì¡°íšŒ (SQLite)
- íŠ¹ì • ì¡°ë¬¸ ì§ì ‘ ì¡°íšŒ (ì •ê·œì‹ íŒ¨í„´ ë§¤ì¹­)

**LLM í˜¸ì¶œ**: âŒ ì—†ìŒ
- ì„ë² ë”© ëª¨ë¸(`kure_v1`) ì‚¬ìš©í•˜ì§€ë§Œ ì´ëŠ” LLMì´ ì•„ë‹˜
- ë²¡í„° ë³€í™˜ë§Œ ìˆ˜í–‰, GPT API í˜¸ì¶œ ì—†ìŒ

**ì½”ë“œ ì¦ê±°**:
```python
# Line 155: ì„ë² ë”© ìƒì„± (ë¡œì»¬ ëª¨ë¸, LLM ì•„ë‹˜)
embedding = self.embedding_model.encode(query).tolist()

# Line 157: ChromaDB ë²¡í„° ê²€ìƒ‰ (DB ì¿¼ë¦¬, LLM ì•„ë‹˜)
results = self.collection.query(
    query_embeddings=[embedding],
    where=filter_dict,
    n_results=limit
)

# Line 212: SQL ë©”íƒ€ë°ì´í„° ë³´ê°• (DB ì¿¼ë¦¬, LLM ì•„ë‹˜)
law_info = self.metadata_helper.get_law_by_title(law_title, fuzzy=True)
```

---

#### 2. regulation_search_tool.py (Mock ë°ì´í„°)
**ë™ì‘**: Mock ë°ì´í„° ë°˜í™˜ë§Œ

**LLM í˜¸ì¶œ**: âŒ ì—†ìŒ

---

#### 3. loan_search_tool.py (Mock ë°ì´í„°)
**ë™ì‘**: Mock ë°ì´í„° ë°˜í™˜ë§Œ

**LLM í˜¸ì¶œ**: âŒ ì—†ìŒ

---

#### 4. real_estate_search_tool.py (Mock ë°ì´í„°)
**ë™ì‘**: Mock ë°ì´í„° ë°˜í™˜ë§Œ

**LLM í˜¸ì¶œ**: âŒ ì—†ìŒ

---

#### 5. analysis_tools.py (í†µê³„ ë¶„ì„)
**ë™ì‘**:
- ì‹œì¥ ë¶„ì„ (í†µê³„ ê³„ì‚°)
- íŠ¸ë Œë“œ ë¶„ì„ (ì¶”ì„¸ ê³„ì‚°)
- ë¹„êµ ë¶„ì„ (ë°ì´í„° ë¹„êµ)
- íˆ¬ì í‰ê°€ (ìˆ˜ìµë¥  ê³„ì‚°)
- ë¦¬ìŠ¤í¬ í‰ê°€ (ì ìˆ˜ ê³„ì‚°)

**LLM í˜¸ì¶œ**: âŒ ì—†ìŒ

---

### LLM vs ì„ë² ë”© ëª¨ë¸ ì°¨ì´

| í•­ëª© | LLM (GPT-4o-mini) | ì„ë² ë”© ëª¨ë¸ (kure_v1) |
|------|------------------|---------------------|
| **ëª©ì ** | í…ìŠ¤íŠ¸ ìƒì„±, ì¶”ë¡ , íŒë‹¨ | í…ìŠ¤íŠ¸ â†’ ë²¡í„° ë³€í™˜ |
| **ì…ë ¥** | í”„ë¡¬í”„íŠ¸ (ìì—°ì–´) | í…ìŠ¤íŠ¸ (ë‹¨ì¼ ë¬¸ì¥) |
| **ì¶œë ¥** | í…ìŠ¤íŠ¸ (JSON/ìì—°ì–´) | 1024ì°¨ì› ë²¡í„° |
| **API í˜¸ì¶œ** | OpenAI API í˜¸ì¶œ (ë¹„ìš© ë°œìƒ) | ë¡œì»¬ ëª¨ë¸ (ë¹„ìš© ì—†ìŒ) |
| **ì†Œìš” ì‹œê°„** | 2-5ì´ˆ | 0.05ì´ˆ |
| **ì‚¬ìš© ìœ„ì¹˜** | Supervisor, SearchAgent | legal_search_toolë§Œ |

---

### ì‹œìŠ¤í…œ ì „ì²´ LLM í˜¸ì¶œ ìš”ì•½

**ì´ LLM í˜¸ì¶œ**: 4íšŒ (ëª¨ë‘ Supervisor + SearchAgent)

| êµ¬ë¶„ | LLM í˜¸ì¶œ | ë²¡í„° ê²€ìƒ‰ | SQL ì¿¼ë¦¬ |
|------|---------|----------|---------|
| **Supervisor** | 2íšŒ âœ“ | - | - |
| **SearchAgent** | 2íšŒ âœ“ | - | - |
| **Tool (legal_search)** | - | 1íšŒ (0.15ì´ˆ) | NíšŒ (0.005ì´ˆ) |
| **Tool (ê¸°íƒ€)** | - | - | - |

**ì „ì²´ ì²˜ë¦¬ ì‹œê°„ ë¶„ì„** (ì¿¼ë¦¬: "ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„"):
```
ì´ 29.26ì´ˆ
â”œâ”€ LLM í˜¸ì¶œ: ~13ì´ˆ (44%)
â”‚  â”œâ”€ Supervisor LLM #1: 2.6ì´ˆ
â”‚  â”œâ”€ Supervisor LLM #2: 5.5ì´ˆ
â”‚  â”œâ”€ SearchAgent LLM #3: 2.7ì´ˆ
â”‚  â””â”€ SearchAgent LLM #4: 2.3ì´ˆ
â”‚
â”œâ”€ ë²¡í„° ê²€ìƒ‰ (Tool): 0.15ì´ˆ (0.5%)
â”œâ”€ SQL ì¿¼ë¦¬ (Tool): 0.005ì´ˆ (0.02%)
â””â”€ ê¸°íƒ€ (ì´ˆê¸°í™”, ì§ë ¬í™”): ~16ì´ˆ (55%)
```

**í•µì‹¬**:
- Tool ì‹¤í–‰ì€ ë§¤ìš° ë¹ ë¦„ (0.155ì´ˆ)
- ë³‘ëª©ì€ LLM í˜¸ì¶œ (13ì´ˆ)
- ìµœì í™” ë°©í–¥: LLM í˜¸ì¶œ íšŸìˆ˜ ê°ì†Œ (4íšŒ â†’ 1-2íšŒ)

---

## ğŸ“ˆ LLM í˜¸ì¶œ ìš”ì•½

| # | ìœ„ì¹˜ | ë©”ì„œë“œ | ëª©ì  | ì†Œìš”ì‹œê°„ | Input | Output |
|---|------|--------|------|----------|-------|--------|
| 1 | Supervisor | `analyze_intent()` (Stage 1+2) | ì„œë¹„ìŠ¤ ê´€ë ¨ì„± + ì§ˆë¬¸ ì˜ë„ íŒŒì•… | ~2.6ì´ˆ | query | intent_type, entities, keywords, confidence |
| 2 | Supervisor | `create_execution_plan()` | ì—ì´ì „íŠ¸ ì„ íƒ + í‚¤ì›Œë“œ ìƒì„± | ~5.5ì´ˆ | query + intent | agents, collection_keywords, reasoning |
| 3 | SearchAgent | `create_search_plan()` | Tool ì„ íƒ + íŒŒë¼ë¯¸í„° ìƒì„± | ~2.7ì´ˆ | query + keywords | selected_tools, tool_parameters, search_strategy |
| 4 | SearchAgent | `decide_next_action()` | ê²€ìƒ‰ ê²°ê³¼ í‰ê°€ | ~2.3ì´ˆ | collected_data + query | next_action, summary, reasoning |

**ì´ LLM í˜¸ì¶œ**: 4ë²ˆ
**ì´ LLM ì†Œìš”ì‹œê°„**: ~13.1ì´ˆ
**ë²¡í„° ê²€ìƒ‰ ì‹œê°„**: ~0.15ì´ˆ (ì¹´í…Œê³ ë¦¬ í•„í„° ì ìš© í›„)
**ì „ì²´ ì‹¤í–‰ ì‹œê°„**: 29.26ì´ˆ (ë‚˜ë¨¸ì§€ëŠ” ì´ˆê¸°í™”, ì§ë ¬í™” ë“±)

---

## ğŸ’¾ ì‹¤ì œ ë¡œê·¸ íƒ€ì„ë¼ì¸ (2025-10-01 17:51:57 ì‹¤í–‰)

```
17:51:57.275 - [START] Supervisor: analyze_intent_node
17:51:57.660 - [LLM #1-1] Stage 1: ì„œë¹„ìŠ¤ ê´€ë ¨ì„± íŒë‹¨ (OpenAI API í˜¸ì¶œ)
17:51:59.896 - [LLM #1-2] Stage 2: ì˜ë„ ìƒì„¸ ë¶„ì„ (OpenAI API í˜¸ì¶œ)
17:52:02.350 - [LLM #1 ì™„ë£Œ] Intent: legal, confidence: 85%

17:52:02.350 - [START] Supervisor: create_plan_node
17:52:02.350 - [LLM #2] ì‹¤í–‰ ê³„íš ìƒì„± (OpenAI API í˜¸ì¶œ)
17:52:07.879 - [LLM #2 ì™„ë£Œ] Selected agents: search_agent
                    Keywords: ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„, ì „ì„¸ ì¬ê³„ì•½ ë²•ë¥ , ì „ì„¸ê¸ˆ ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ê¸ˆì•¡

17:52:07.879 - [START] Supervisor: execute_agents_node
17:52:20.958 - [START] SearchAgent: create_search_plan_node
17:52:20.958 - [LLM #3] ê²€ìƒ‰ ê³„íš ìƒì„± (OpenAI API í˜¸ì¶œ)
17:52:23.652 - [LLM #3 ì™„ë£Œ] Selected tools: legal_search
                    Parameters: {query: "ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„", category: "2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸"}

17:52:23.652 - [START] SearchAgent: execute_tools_node
17:52:23.652 - [TOOL] legal_search ì‹¤í–‰ (ChromaDB ë²¡í„° ê²€ìƒ‰)
                    Filter: {'is_deleted': False}
17:52:24.162 - [TOOL ì™„ë£Œ] legal_search: 10 results

17:52:24.162 - [START] SearchAgent: decide_next_action_node
17:52:24.162 - [LLM #4] ë‹¤ìŒ ì•¡ì…˜ ê²°ì • (OpenAI API í˜¸ì¶œ)
17:52:26.509 - [LLM #4 ì™„ë£Œ] Next action: return_to_supervisor

17:52:26.525 - [START] Supervisor: generate_response_node
17:52:26.525 - [ì™„ë£Œ] Final response ìƒì„± (LLM í˜¸ì¶œ ì—†ìŒ)
```

---

## ğŸ’¡ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ê°œì„  ì‚¬í•­

### ê°œì„  #1: SearchAgent doc_type í•„í„°ë§ ë¬¸ì œ í•´ê²° (2025-10-01 ì ìš©)

**ë¬¸ì œ**:
- SearchAgent LLMì´ `doc_type: "ê¸°íƒ€"` ì„ íƒ â†’ 0 results
- "ê¸°íƒ€"ëŠ” ì „ì²´ ë°ì´í„°ì˜ 1.4%ë§Œ í•´ë‹¹ (23/1700 ë¬¸ì„œ)

**í•´ê²°ì±…**: í”„ë¡¬í”„íŠ¸ì— í•„í„° ì‚¬ìš© ê°€ì´ë“œ ì¶”ê°€

**Before** (Lines 123-154):
```python
ë²•ë¥  ê²€ìƒ‰ ì˜ˆì‹œ:
- "ì„ëŒ€ì°¨ ê³„ì•½ ë³´ì¦ê¸ˆ" â†’ legal_search with category="2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸"
- "ê³µì¸ì¤‘ê°œì‚¬ë²• ì‹œí–‰ë ¹" â†’ legal_search with doc_type="ì‹œí–‰ë ¹"
- "ì„ì°¨ì¸ ë³´í˜¸ ì¡°í•­" â†’ legal_search with is_tenant_protection=true
```

**After** (Lines 136-153):
```python
âš ï¸ legal_search í•„í„° ì‚¬ìš© ê°€ì´ë“œ:
ã€doc_type í•„í„° - ë§¤ìš° ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©ã€‘
  â€¢ doc_typeì€ ì‚¬ìš©ìê°€ "ì‹œí–‰ë ¹", "ì‹œí–‰ê·œì¹™", "ëŒ€ë²•ì›ê·œì¹™" ë“±ì„ ëª…ì‹œì ìœ¼ë¡œ ì–¸ê¸‰í•œ ê²½ìš°ë§Œ ì‚¬ìš©
  â€¢ "ë²•ë¥ ", "ë²•", "ë²•ë ¹" ê°™ì€ ì¼ë°˜ì ì¸ ë‹¨ì–´ëŠ” doc_type ì§€ì • ê¸ˆì§€ (ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ìë™ ì²˜ë¦¬ë¨)
  â€¢ "ê¸°íƒ€"ëŠ” ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€ (ì „ì²´ ë°ì´í„°ì˜ 1.4%ë§Œ í•´ë‹¹)
  â€¢ ë¶ˆí™•ì‹¤í•˜ë©´ doc_typeì„ ìƒëµ â†’ ì „ì²´ ë¬¸ì„œì—ì„œ ë²¡í„° ê²€ìƒ‰ ìˆ˜í–‰ (ê¶Œì¥)

ã€category í•„í„° - ì ê·¹ í™œìš© ê¶Œì¥ã€‘
  â€¢ "ì„ëŒ€ì°¨", "ì „ì„¸", "ì›”ì„¸" â†’ category="2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸"
  â€¢ "ë§¤ë§¤", "ë¶„ì–‘", "ê³µê¸‰" â†’ category="3_ê³µê¸‰_ë°_ê´€ë¦¬_ë§¤ë§¤_ë¶„ì–‘"
  â€¢ categoryëŠ” doc_typeë³´ë‹¤ ì•ˆì „í•˜ê³  íš¨ê³¼ì 

ë²•ë¥  ê²€ìƒ‰ ì˜ˆì‹œ:
- "ì „ì„¸ê¸ˆ ì¸ìƒ ë²•ë¥ " â†’ legal_search (doc_type ì—†ìŒ, category="2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸")
- "ì„ëŒ€ì°¨ ê³„ì•½ ë³´ì¦ê¸ˆ" â†’ legal_search (doc_type ì—†ìŒ, category="2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸")
- "ê³µì¸ì¤‘ê°œì‚¬ë²• ì‹œí–‰ë ¹" â†’ legal_search with doc_type="ì‹œí–‰ë ¹" (ëª…ì‹œì ìœ¼ë¡œ "ì‹œí–‰ë ¹" ì–¸ê¸‰)
```

**ê²°ê³¼**:
- âŒ Before: `doc_type: "ê¸°íƒ€"` â†’ 0 results
- âœ… After: `doc_type: None`, `category: "2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸"` â†’ 10 results

**íŒŒì¼**: `backend/app/service/agents/search_agent.py:136-153`

---

## ğŸ¯ í–¥í›„ ìµœì í™” ë°©ì•ˆ

### Option 1: Supervisor LLM í˜¸ì¶œ í†µí•© (4íšŒ â†’ 3íšŒ)

**í˜„ì¬ ë¬¸ì œ**:
- LLM #1: analyze_intent() - ì˜ë„ ë¶„ì„
- LLM #2: create_execution_plan() - ì—ì´ì „íŠ¸ ì„ íƒ
- ë‘ ì‘ì—…ì´ ìœ ì‚¬í•˜ê³  ì§ë ¬ ì²˜ë¦¬ë¨

**ì œì•ˆ**:
```python
# í†µí•© í”„ë¡¬í”„íŠ¸
system_prompt = """ë‹¹ì‹ ì€ ë¶€ë™ì‚° ì±—ë´‡ì˜ ì˜ë„ ë¶„ì„ ë° ì‹¤í–‰ ê³„íš ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì‚¬ìš©ì ì§ˆì˜ë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ìŒì„ í•œ ë²ˆì— ìˆ˜í–‰í•˜ì„¸ìš”:
1. ì„œë¹„ìŠ¤ ê´€ë ¨ì„± íŒë‹¨ (is_relevant)
2. ì˜ë„ ë¶„ë¥˜ (intent_type)
3. ì—ì´ì „íŠ¸ ì„ íƒ (agents)
4. ê²€ìƒ‰ í‚¤ì›Œë“œ ìƒì„± (collection_keywords)

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ:
{
    "is_relevant": true/false,
    "intent_type": "legal",
    "agents": ["search_agent"],
    "collection_keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"],
    "confidence": 0.85
}"""
```

**ì˜ˆìƒ íš¨ê³¼**:
- LLM í˜¸ì¶œ 1íšŒ ì ˆê° (4íšŒ â†’ 3íšŒ)
- ì‹¤í–‰ ì‹œê°„ ~5ì´ˆ ì ˆê° (29ì´ˆ â†’ 24ì´ˆ)

---

### Option 2: decide_next_actionì„ Rule-basedë¡œ (4íšŒ â†’ 3íšŒ)

**í˜„ì¬ ë¬¸ì œ**:
- LLM #4: decide_next_action() - ë‹¨ìˆœíˆ "ë°ì´í„° ì¶©ë¶„í•œê°€?" íŒë‹¨
- ëŒ€ë¶€ë¶„ì˜ ê²½ìš° result countë§Œ ì²´í¬í•˜ë©´ ë¨

**ì œì•ˆ**:
```python
async def decide_next_action_node(self, state):
    collected_data = state.get("collected_data", {})

    # Rule-based íŒë‹¨
    total_results = sum(len(data) for data in collected_data.values() if isinstance(data, list))

    if total_results >= 5:
        # ì¶©ë¶„í•œ ë°ì´í„° â†’ Supervisorë¡œ ë³µê·€
        return {
            "next_action": "return_to_supervisor",
            "summary": f"{total_results}ê°œ ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ì§‘ ì™„ë£Œ",
            "reasoning": "ì¶©ë¶„í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆ˜ì§‘ë˜ì–´ ê°ë…ìì—ê²Œ ë°˜í™˜í•©ë‹ˆë‹¤."
        }
    elif total_results == 0:
        # ë°ì´í„° ì—†ìŒ â†’ ì—ëŸ¬
        return {
            "next_action": "return_to_supervisor",
            "summary": "ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ",
            "reasoning": "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ ê°ë…ìì—ê²Œ ë°˜í™˜í•©ë‹ˆë‹¤."
        }
    else:
        # ì• ë§¤í•œ ê²½ìš°ë§Œ LLM í˜¸ì¶œ (1-4ê°œ ê²°ê³¼)
        decision = await self.llm_client.decide_next_action(collected_data, state["original_query"])
        return decision
```

**ì˜ˆìƒ íš¨ê³¼**:
- 80% ì¼€ì´ìŠ¤ì—ì„œ LLM í˜¸ì¶œ 1íšŒ ì ˆê° (4íšŒ â†’ 3íšŒ)
- ì‹¤í–‰ ì‹œê°„ ~2ì´ˆ ì ˆê° (29ì´ˆ â†’ 27ì´ˆ)

---

### Option 3: ê°„ë‹¨í•œ ì§ˆë¬¸ Rule-based ì‚¬ì „ ì²˜ë¦¬ (4íšŒ â†’ 2íšŒ)

**ì œì•ˆ**:
```python
async def preprocess_query_node(state):
    query = state["query"]

    # Rule 1: ë²•ë¥  ê´€ë ¨ í‚¤ì›Œë“œ ë§¤ì¹­
    legal_keywords = ["ë²•ë¥ ", "ê·œì •", "ê³„ì•½", "ì„¸ê¸ˆ", "ì „ì„¸ê¸ˆ ì¸ìƒ", "ë³´ì¦ê¸ˆ ì¦ì•¡"]
    if any(k in query for k in legal_keywords):
        return {
            "intent_type": "legal",
            "selected_agents": ["search_agent"],
            "collection_keywords": extract_keywords_rule_based(query),
            "selected_tools": ["legal_search"],
            "tool_parameters": {
                "legal_search": {
                    "query": query,
                    "category": detect_category(query),
                    "limit": 10
                }
            },
            "skip_llm": True  # LLM #1, #2, #3 ìŠ¤í‚µ!
        }

    # Rule 2: ì‹œì„¸/ë§¤ë¬¼ í‚¤ì›Œë“œ
    if any(k in query for k in ["ì‹œì„¸", "ë§¤ë¬¼", "ê°€ê²©", "ì–¼ë§ˆ"]):
        return {
            "intent_type": "search",
            "selected_agents": ["search_agent"],
            "selected_tools": ["real_estate_search"],
            "skip_llm": True
        }

    # ë³µì¡í•œ ê²½ìš°ë§Œ LLM ì‚¬ìš©
    return {"skip_llm": False}
```

**ì˜ˆìƒ íš¨ê³¼**:
- ê°„ë‹¨í•œ ì§ˆë¬¸ (70% ì¼€ì´ìŠ¤): LLM 2-3íšŒ ì ˆê° (4íšŒ â†’ 1-2íšŒ)
- ì‹¤í–‰ ì‹œê°„ ëŒ€í­ ë‹¨ì¶• (29ì´ˆ â†’ 5-10ì´ˆ)

---

## ğŸ† ì¶”ì²œ ìµœì í™” ì „ëµ: Hybrid Approach

```
Phase 1: ì‚¬ì „ í•„í„°ë§ (Rule-based)
  - ëª…í™•í•œ í‚¤ì›Œë“œ â†’ ì¦‰ì‹œ Tool ì„ íƒ (LLM ìŠ¤í‚µ)
  - ì• ë§¤í•œ ê²½ìš° â†’ LLM ì‚¬ìš©

Phase 2: Supervisor LLM í†µí•©
  - analyze_intent + create_execution_planì„ 1íšŒë¡œ í†µí•©
  - 2íšŒ â†’ 1íšŒ (5ì´ˆ ì ˆê°)

Phase 3: SearchAgent decide_next_action Ruleí™”
  - ê²°ê³¼ ê°œìˆ˜ë¡œ íŒë‹¨ (result >= 5 â†’ return)
  - 1íšŒ â†’ 0íšŒ (2ì´ˆ ì ˆê°)

ìµœì¢… ê²°ê³¼:
- ê°„ë‹¨í•œ ì§ˆë¬¸: LLM 1-2íšŒ (í˜„ì¬ 4íšŒ)
- ë³µì¡í•œ ì§ˆë¬¸: LLM 2-3íšŒ (í˜„ì¬ 4íšŒ)
- í‰ê·  ì‹¤í–‰ì‹œê°„: 10-15ì´ˆ (í˜„ì¬ 29ì´ˆ)
- ë¹„ìš© ì ˆê°: 50-75%
```

---

## ğŸ“Š í˜„ì¬ vs ìµœì í™” í›„ ë¹„êµ

| í•­ëª© | í˜„ì¬ | Phase 1 | Phase 2 | Phase 3 (ìµœì¢…) |
|------|------|---------|---------|----------------|
| LLM #1 (analyze_intent) | âœ“ | Rule | Rule | Rule |
| LLM #2 (create_plan) | âœ“ | âœ“ | (í†µí•©) | (í†µí•©) |
| LLM #3 (search_plan) | âœ“ | Rule | Rule | Rule |
| LLM #4 (decide_action) | âœ“ | âœ“ | âœ“ | Rule |
| **ì´ LLM í˜¸ì¶œ** | **4íšŒ** | **2íšŒ** | **1íšŒ** | **1íšŒ** |
| **ì‹¤í–‰ ì‹œê°„** | **29ì´ˆ** | **15ì´ˆ** | **10ì´ˆ** | **8ì´ˆ** |
| **ë¹„ìš©** | 4x | 2x | 1x | 1x |
| **ì •í™•ë„** | ë†’ìŒ | ë†’ìŒ | ì¤‘ê°„ | ì¤‘ê°„ |

---

## ğŸ”§ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### 1ìˆœìœ„: Option 2 (decide_next_action Ruleí™”) â­â­â­
- **ë‚œì´ë„**: ë‚®ìŒ
- **íš¨ê³¼**: LLM 1íšŒ ì ˆê° (25% ì ˆê°)
- **ë¦¬ìŠ¤í¬**: ë‚®ìŒ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
- **êµ¬í˜„ ì‹œê°„**: 1ì‹œê°„

### 2ìˆœìœ„: Option 1 (Supervisor LLM í†µí•©) â­â­
- **ë‚œì´ë„**: ì¤‘ê°„
- **íš¨ê³¼**: LLM 1íšŒ ì ˆê° (25% ì ˆê°)
- **ë¦¬ìŠ¤í¬**: ì¤‘ê°„ (í”„ë¡¬í”„íŠ¸ ë³µì¡ë„ ì¦ê°€)
- **êµ¬í˜„ ì‹œê°„**: 3ì‹œê°„

### 3ìˆœìœ„: Option 3 (Rule-based ì‚¬ì „ ì²˜ë¦¬) â­â­â­â­â­
- **ë‚œì´ë„**: ë†’ìŒ
- **íš¨ê³¼**: LLM 2-3íšŒ ì ˆê° (50-75% ì ˆê°)
- **ë¦¬ìŠ¤í¬**: ë†’ìŒ (ì •í™•ë„ ì €í•˜ ê°€ëŠ¥ì„±)
- **êµ¬í˜„ ì‹œê°„**: 1-2ì¼

---

## ğŸ“ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… ì™„ë£Œëœ ê°œì„ 
- [x] SearchAgent doc_type í•„í„° ê³¼ë„ ì‚¬ìš© ë°©ì§€ (2025-10-01)
- [x] legal_search í•„í„° ì‚¬ìš© ê°€ì´ë“œ ì¶”ê°€
- [x] ì˜ˆì‹œ ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ê°œì„  (Few-shot Learning)

### ğŸ”„ ì§„í–‰ ì¤‘
- [ ] Supervisor LLM í˜¸ì¶œ í†µí•© ê²€í† 
- [ ] decide_next_action Ruleí™” ê²€í† 

### ğŸ“‹ í–¥í›„ ê³„íš
- [ ] Rule-based ì‚¬ì „ ì²˜ë¦¬ ì‹œìŠ¤í…œ ì„¤ê³„
- [ ] í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•
- [ ] A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ë„ì…
- [ ] LLM ì‘ë‹µ ìºì‹± ì‹œìŠ¤í…œ êµ¬ì¶•

---

## ğŸ†• 2025-10-02 ì—…ë°ì´íŠ¸: ì‹ ê·œ Agent ì¶”ê°€

### DocumentAgent LLM í˜¸ì¶œ ë¶„ì„
**ìœ„ì¹˜**: `agents/document_agent.py`
**LLM í˜¸ì¶œ**: í˜„ì¬ 0íšŒ (Simple rule-based)

```python
# í˜„ì¬ êµ¬í˜„: Rule-based ë¬¸ì„œ ìœ í˜• ê°ì§€
def _simple_analyze(self, query: str) -> Dict[str, Any]:
    query_lower = query.lower()
    if "ì„ëŒ€ì°¨" in query_lower or "ì›”ì„¸" in query_lower:
        doc_type = "ì„ëŒ€ì°¨ê³„ì•½ì„œ"
    # ... í‚¤ì›Œë“œ ë§¤ì¹­
```

**í–¥í›„ LLM í†µí•© ì‹œ**:
```python
# LLMì„ ì‚¬ìš©í•œ íŒŒë¼ë¯¸í„° ì¶”ì¶œ
prompt = """
ë¬¸ì„œ ìƒì„± ìš”ì²­: {query}
í•„ìš”í•œ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œí•˜ì„¸ìš”:
- ì„ëŒ€ì¸/ì„ì°¨ì¸ ì´ë¦„
- ì£¼ì†Œ
- ê¸ˆì•¡
"""
```

### ReviewAgent LLM í˜¸ì¶œ ë¶„ì„
**ìœ„ì¹˜**: `agents/review_agent.py`
**LLM í˜¸ì¶œ**: í˜„ì¬ 0íšŒ (Rule-based review)

**ê·œì¹™ ê¸°ë°˜ ìœ„í—˜ ë¶„ì„**:
```python
risk_patterns = [
    {
        "pattern": r"ì¤‘ë„\s*í•´ì§€.*ë¶ˆê°€",
        "risk_level": "high",
        "description": "ì¤‘ë„ í•´ì§€ ë¶ˆê°€ ì¡°í•­"
    }
]
```

**í–¥í›„ LLM í†µí•© ì‹œ**:
- ë³µì¡í•œ ì¡°í•­ í•´ì„
- ë§¥ë½ ê¸°ë°˜ ìœ„í—˜ í‰ê°€
- ìì—°ì–´ ê¶Œê³ ì‚¬í•­ ìƒì„±

---

## ğŸ”§ ë²•ë¥  ê²€ìƒ‰ ê°œì„  ì‚¬í•­ (2025-10-02)

### SQL + ChromaDB í•˜ì´ë¸Œë¦¬ë“œ êµ¬í˜„
**íŒŒì¼**: `tools/legal_query_helper.py` (ì‹ ê·œ)

**ê²€ìƒ‰ í”Œë¡œìš° ê°œì„ **:
```python
1. SQLì—ì„œ ë²•ë¥  ì¡´ì¬ í™•ì¸
   â†’ check_law_exists(title)

2. ì¡´ì¬í•˜ëŠ” ê²½ìš° chunk_ids ì¡°íšŒ
   â†’ get_article_chunk_ids(title, article_number)

3. ChromaDBì—ì„œ ì§ì ‘ ì¡°íšŒ (ë²¡í„° ê²€ìƒ‰ ìŠ¤í‚µ)
   â†’ collection.get(ids=chunk_ids)

4. ì—†ëŠ” ë²•ë¥ ì€ "ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë°˜í™˜
   â†’ format_results(data=[{"type": "error", ...}])
```

**ì„±ê³¼**:
- íŠ¹ì • ì¡°í•­ ê²€ìƒ‰: 80% â†’ 100% ì„±ê³µë¥ 
- "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°" ì •í™•íˆ ë°˜í™˜
- ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë²•ë¥  ëª…í™•íˆ êµ¬ë¶„

### í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½

#### hard_query_test_100.py ê²°ê³¼
- **Part 1 (1-50)**: ì‹¤ì œ ë²•ë¥  ê²€ìƒ‰
  - ì„±ê³µ: 31/50 (62%)
  - íŠ¹ì • ì¡°í•­ ì™„ë²½ ê²€ìƒ‰ (ì œ7ì¡°, ì œ8ì¡° ë“±)
- **Part 2 (51-100)**: ì—†ëŠ” ë²•ë¥  ê²€ì¦
  - Unicode ì—ëŸ¬ë¡œ ì¤‘ë‹¨ (Windows ì´ìŠˆ)

#### test_nonexistent_laws.py ê²°ê³¼
- 5ê°œ ì—†ëŠ” ë²•ë¥  ëª¨ë‘ "ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë°˜í™˜
- 100% ì„±ê³µë¥ 

---

## ğŸ“š ì°¸ê³  ìë£Œ

### íŒŒì¼ ìœ„ì¹˜
- Supervisor: `backend/app/service/supervisor/supervisor.py`
- SearchAgent: `backend/app/service/agents/search_agent.py`
- DocumentAgent: `backend/app/service/agents/document_agent.py` ğŸ†•
- ReviewAgent: `backend/app/service/agents/review_agent.py` ğŸ†•
- LegalSearchTool: `backend/app/service/tools/legal_search_tool.py`
- LegalQueryHelper: `backend/app/service/tools/legal_query_helper.py` ğŸ†•
- DocumentGenerationTool: `backend/app/service/tools/document_generation_tool.py` ğŸ†•
- ContractReviewTool: `backend/app/service/tools/contract_review_tool.py` ğŸ†•
- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸: `backend/app/service/tests/query_test_2agent.py`
- ì‹ ê·œ í…ŒìŠ¤íŠ¸: `backend/app/service/tests/test_new_agents.py` ğŸ†•

### ì£¼ìš” ì„¤ì •
- LLM ëª¨ë¸: `gpt-4o-mini`
- Temperature: 0.3 (search), 0.1 (intent)
- Max Tokens: 1000
- Response Format: JSON

### ChromaDB í†µê³„
- ì´ ë¬¸ì„œ: 1,700ê°œ
- DB í¬ê¸°: 59MB
- ì„ë² ë”© ì°¨ì›: 1024D
- ë¬¸ì„œ íƒ€ì… ë¶„í¬:
  - ë²•ë¥ : 666 (39.2%)
  - ì‹œí–‰ë ¹: 426 (25.1%)
  - ì‹œí–‰ê·œì¹™: 268 (15.8%)
  - ëŒ€ë²•ì›ê·œì¹™: 225 (13.2%)
  - ìš©ì–´ì§‘: 92 (5.4%)
  - ê¸°íƒ€: 23 (1.4%) â† ìµœì†Œ!
