# LLM Manager ê¸°ë°˜ ì „ì²´ ì‹œìŠ¤í…œ Flow Chart & í”„ë¡¬í”„íŠ¸ ì‚¬ìš© ë©”ë‰´ì–¼

**ì‘ì„±ì¼**: 2025-10-05
**ë²„ì „**: 1.0
**ëŒ€ìƒ**: ê°œë°œì ë° ì‹œìŠ¤í…œ ì´í•´ë¥¼ ìœ„í•œ ìƒì„¸ ê°€ì´ë“œ

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [ì „ì²´ ì‹œìŠ¤í…œ Flow Chart](#2-ì „ì²´-ì‹œìŠ¤í…œ-flow-chart)
3. [LLM í˜¸ì¶œ ì§€ì  ë§µ](#3-llm-í˜¸ì¶œ-ì§€ì -ë§µ)
4. [í”„ë¡¬í”„íŠ¸ ì¹´íƒˆë¡œê·¸](#4-í”„ë¡¬í”„íŠ¸-ì¹´íƒˆë¡œê·¸)
5. [Phaseë³„ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©](#5-phaseë³„-í”„ë¡¬í”„íŠ¸-ì‚¬ìš©)
6. [LLM Manager ì•„í‚¤í…ì²˜](#6-llm-manager-ì•„í‚¤í…ì²˜)
7. [í”„ë¡¬í”„íŠ¸ ì‘ì„± ê°€ì´ë“œ](#7-í”„ë¡¬í”„íŠ¸-ì‘ì„±-ê°€ì´ë“œ)
8. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#8-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## 1. ê°œìš”

### 1.1 LLM Managerì˜ ì—­í• 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LLM Manager                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  LLMService                                        â”‚ â”‚
â”‚  â”‚  - LLM API í˜¸ì¶œ (OpenAI)                          â”‚ â”‚
â”‚  â”‚  - JSON/Text ì‘ë‹µ ì²˜ë¦¬                            â”‚ â”‚
â”‚  â”‚  - ì—ëŸ¬ í•¸ë“¤ë§ & ì¬ì‹œë„                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†•                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PromptManager                                     â”‚ â”‚
â”‚  â”‚  - í”„ë¡¬í”„íŠ¸ íŒŒì¼ ë¡œë“œ (.txt, .yaml)               â”‚ â”‚
â”‚  â”‚  - ë³€ìˆ˜ ì¹˜í™˜ ({query}, {keywords} ë“±)             â”‚ â”‚
â”‚  â”‚  - í”„ë¡¬í”„íŠ¸ ìºì‹±                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†•                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Prompts Directory                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ cognitive/    (ì‚¬ê³ /ê³„íš í”„ë¡¬í”„íŠ¸)           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ execution/    (ì‹¤í–‰ í”„ë¡¬í”„íŠ¸)                â”‚ â”‚
â”‚  â”‚  â””â”€â”€ common/       (ê³µí†µ í”„ë¡¬í”„íŠ¸)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 í•µì‹¬ ê°œë…

- **ì¤‘ì•™ ì§‘ì¤‘ ê´€ë¦¬**: ëª¨ë“  í”„ë¡¬í”„íŠ¸ë¥¼ `llm_manager/prompts`ì—ì„œ ê´€ë¦¬
- **ë¶„ë¦¬ëœ ê´€ì‹¬ì‚¬**: í”„ë¡¬í”„íŠ¸(í…œí”Œë¦¿)ì™€ ë¡œì§(ì½”ë“œ)ë¥¼ ë¶„ë¦¬
- **ì¬ì‚¬ìš©ì„±**: ë™ì¼ í”„ë¡¬í”„íŠ¸ë¥¼ ì—¬ëŸ¬ Agentì—ì„œ ì‚¬ìš© ê°€ëŠ¥
- **ë²„ì „ ê´€ë¦¬**: Gitìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ ë³€ê²½ ì´ë ¥ ì¶”ì 

---

## 2. ì „ì²´ ì‹œìŠ¤í…œ Flow Chart

### 2.1 High-Level Flow (ì‚¬ìš©ì â†’ ì‘ë‹µ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ì ì§ˆë¬¸                              â”‚
â”‚                  "ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸ ì „ì„¸ ì‹œì„¸ì™€ ë²•ì  ì œí•œ"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 0: ì´ˆê¸°í™”                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  TeamBasedSupervisor.initialize_node()                          â”‚
â”‚  - State ì¤€ë¹„                                                    â”‚
â”‚  - Session ID ìƒì„±                                               â”‚
â”‚  - LLM Context ì„¤ì •                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 1: ê³„íš ìˆ˜ë¦½ (Planning)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  TeamBasedSupervisor.planning_node()                            â”‚
â”‚       â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PlanningAgent.analyze_intent()                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ ğŸ¤– LLM í˜¸ì¶œ #1: ì˜ë„ ë¶„ì„                               â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚   â”‚
â”‚  â”‚ Prompt: "intent_analysis"                               â”‚   â”‚
â”‚  â”‚ Input:  {query: "ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸..."}                     â”‚   â”‚
â”‚  â”‚ Model:  GPT-4o-mini (temp=0.1)                          â”‚   â”‚
â”‚  â”‚ Output: {                                               â”‚   â”‚
â”‚  â”‚   intent: "COMPREHENSIVE",                              â”‚   â”‚
â”‚  â”‚   confidence: 0.92,                                     â”‚   â”‚
â”‚  â”‚   keywords: ["ê°•ë‚¨êµ¬", "ì•„íŒŒíŠ¸", "ì „ì„¸", "ì‹œì„¸", "ë²•ì "] â”‚   â”‚
â”‚  â”‚   entities: {location: "ê°•ë‚¨êµ¬", ...}                   â”‚   â”‚
â”‚  â”‚ }                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PlanningAgent._suggest_agents()                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ ğŸ¤– LLM í˜¸ì¶œ #2: Agent ì„ íƒ                              â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚   â”‚
â”‚  â”‚ Prompt: "agent_selection"                               â”‚   â”‚
â”‚  â”‚ Input:  {                                               â”‚   â”‚
â”‚  â”‚   query: "ê°•ë‚¨êµ¬...",                                   â”‚   â”‚
â”‚  â”‚   intent_type: "COMPREHENSIVE",                         â”‚   â”‚
â”‚  â”‚   keywords: [...],                                      â”‚   â”‚
â”‚  â”‚   available_agents: {...}                               â”‚   â”‚
â”‚  â”‚ }                                                        â”‚   â”‚
â”‚  â”‚ Model:  GPT-4o-mini (temp=0.1)                          â”‚   â”‚
â”‚  â”‚ Output: {                                               â”‚   â”‚
â”‚  â”‚   selected_agents: ["search_team", "analysis_team"],    â”‚   â”‚
â”‚  â”‚   reasoning: "ë²•ë¥  ê²€ìƒ‰ê³¼ ì‹œì„¸ ë°ì´í„°ê°€ í•„ìš”í•˜ë©°..."    â”‚   â”‚
â”‚  â”‚ }                                                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ âš ï¸ ì‹¤íŒ¨ ì‹œ Fallback:                                    â”‚   â”‚
â”‚  â”‚ â†’ agent_selection_simple (ê°„ì†Œí™” í”„ë¡¬í”„íŠ¸)              â”‚   â”‚
â”‚  â”‚ â†’ Safe Default (í¬ê´„ì  ì¡°í•©)                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PlanningAgent.create_execution_plan()                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ âœ… ê³„íš ìƒì„± (LLM ì—†ìŒ, ë¡œì§ ê¸°ë°˜)                      â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚   â”‚
â”‚  â”‚ - ExecutionStep ìƒì„±                                    â”‚   â”‚
â”‚  â”‚ - ì˜ì¡´ì„± ì„¤ì • (analysis â†’ search)                       â”‚   â”‚
â”‚  â”‚ - ì‹¤í–‰ ì „ëµ ê²°ì • (SEQUENTIAL/PARALLEL)                  â”‚   â”‚
â”‚  â”‚ - ìš°ì„ ìˆœìœ„ ì„¤ì •                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 2: íŒ€ ì‹¤í–‰ (Execution)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  TeamBasedSupervisor.execute_teams_node()                       â”‚
â”‚       â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ SearchExecutor         â”‚ AnalysisExecutor              â”‚    â”‚
â”‚  â”‚                        â”‚                                â”‚    â”‚
â”‚  â”‚ Step 1: í‚¤ì›Œë“œ ì¶”ì¶œ    â”‚ (search ê²°ê³¼ ëŒ€ê¸°)            â”‚    â”‚
â”‚  â”‚ ğŸ¤– LLM í˜¸ì¶œ #3         â”‚                                â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                                â”‚    â”‚
â”‚  â”‚ Prompt:                â”‚                                â”‚    â”‚
â”‚  â”‚ "keyword_extraction"   â”‚                                â”‚    â”‚
â”‚  â”‚ Input: {               â”‚                                â”‚    â”‚
â”‚  â”‚   query: "ê°•ë‚¨êµ¬...",  â”‚                                â”‚    â”‚
â”‚  â”‚ }                      â”‚                                â”‚    â”‚
â”‚  â”‚ Output: {              â”‚                                â”‚    â”‚
â”‚  â”‚   legal: ["ì „ì„¸", ...],â”‚                                â”‚    â”‚
â”‚  â”‚   real_estate: [...],  â”‚                                â”‚    â”‚
â”‚  â”‚   loan: [...]          â”‚                                â”‚    â”‚
â”‚  â”‚ }                      â”‚                                â”‚    â”‚
â”‚  â”‚     â†“                  â”‚                                â”‚    â”‚
â”‚  â”‚ Step 2: Tool ì‹¤í–‰      â”‚                                â”‚    â”‚
â”‚  â”‚ âœ… Tool í˜¸ì¶œ (LLM X)   â”‚                                â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                                â”‚    â”‚
â”‚  â”‚ - legal_search_tool    â”‚                                â”‚    â”‚
â”‚  â”‚ - market_data_tool     â”‚                                â”‚    â”‚
â”‚  â”‚ - loan_data_tool       â”‚                                â”‚    â”‚
â”‚  â”‚     â†“                  â”‚                                â”‚    â”‚
â”‚  â”‚ Results: [             â”‚                                â”‚    â”‚
â”‚  â”‚   ë²•ë¥  ì¡°í•­ 10ê°œ,      â”‚                                â”‚    â”‚
â”‚  â”‚   ì‹œì„¸ ë°ì´í„° 5ê°œ      â”‚ â† ì´ ê²°ê³¼ë¥¼ analysisì— ì „ë‹¬    â”‚    â”‚
â”‚  â”‚ ]                      â”‚                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ AnalysisExecutor                                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ ğŸ¤– LLM í˜¸ì¶œ #4: ì¸ì‚¬ì´íŠ¸ ìƒì„±                           â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚   â”‚
â”‚  â”‚ Prompt: "insight_generation"                            â”‚   â”‚
â”‚  â”‚ Input:  {                                               â”‚   â”‚
â”‚  â”‚   query: "ê°•ë‚¨êµ¬...",                                   â”‚   â”‚
â”‚  â”‚   search_results: {                                     â”‚   â”‚
â”‚  â”‚     legal: [...],                                       â”‚   â”‚
â”‚  â”‚     market: [...]                                       â”‚   â”‚
â”‚  â”‚   },                                                     â”‚   â”‚
â”‚  â”‚   analysis_type: "comprehensive"                        â”‚   â”‚
â”‚  â”‚ }                                                        â”‚   â”‚
â”‚  â”‚ Model:  GPT-4o (temp=0.3)                               â”‚   â”‚
â”‚  â”‚ Output: {                                               â”‚   â”‚
â”‚  â”‚   insights: [                                           â”‚   â”‚
â”‚  â”‚     "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ì œí•œ ì ìš©ë¨",                       â”‚   â”‚
â”‚  â”‚     "ê°•ë‚¨êµ¬ í‰ê·  ì „ì„¸ê°€ ìƒìŠ¹ ì¶”ì„¸",                     â”‚   â”‚
â”‚  â”‚     "ë²•ì  ë¦¬ìŠ¤í¬: ë‚®ìŒ"                                 â”‚   â”‚
â”‚  â”‚   ],                                                     â”‚   â”‚
â”‚  â”‚   recommendations: [...]                                â”‚   â”‚
â”‚  â”‚ }                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 3: ê²°ê³¼ í†µí•© (Aggregation)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  TeamBasedSupervisor.aggregate_results_node()                   â”‚
â”‚                                                                  â”‚
â”‚  âœ… ë°ì´í„° ë³‘í•© (LLM ì—†ìŒ)                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚  - SearchTeam ê²°ê³¼ + AnalysisTeam ê²°ê³¼ ë³‘í•©                      â”‚
â”‚  - StateManagerë¡œ MainSupervisorState ì—…ë°ì´íŠ¸                   â”‚
â”‚  - ë©”íƒ€ë°ì´í„° í†µí•© (sources, timing, status)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 4: ìµœì¢… ì‘ë‹µ ìƒì„± (Response Generation)                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  TeamBasedSupervisor.generate_response_node()                   â”‚
â”‚                                                                  â”‚
â”‚  ğŸ¤– LLM í˜¸ì¶œ #5: ì‘ë‹µ í•©ì„±                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚  Prompt: "response_synthesis"                                   â”‚
â”‚  Input:  {                                                       â”‚
â”‚    query: "ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸...",                                    â”‚
â”‚    search_results: {...},                                        â”‚
â”‚    analysis_results: {...},                                      â”‚
â”‚    intent: "COMPREHENSIVE"                                       â”‚
â”‚  }                                                               â”‚
â”‚  Model:  GPT-4o-mini (temp=0.3)                                 â”‚
â”‚  Output: "ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸ ì „ì„¸ì˜ ê²½ìš°, ë²•ì ìœ¼ë¡œ 5% ì¸ìƒ ì œí•œì´...  â”‚
â”‚           í˜„ì¬ í‰ê·  ì‹œì„¸ëŠ”... ì£¼ì˜í•˜ì‹¤ ì ì€..."                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                       ìµœì¢… ì‚¬ìš©ì ì‘ë‹µ
```

---

## 3. LLM í˜¸ì¶œ ì§€ì  ë§µ

### 3.1 LLM í˜¸ì¶œ ìš”ì•½

| # | Phase | í˜¸ì¶œ ìœ„ì¹˜ | í”„ë¡¬í”„íŠ¸ | ëª©ì  | ì‘ë‹µ í˜•ì‹ | Model |
|---|-------|----------|---------|------|----------|-------|
| 1 | Planning | PlanningAgent.analyze_intent() | `intent_analysis` | ì‚¬ìš©ì ì˜ë„ ë¶„ì„ | JSON | GPT-4o-mini |
| 2 | Planning | PlanningAgent._suggest_agents() | `agent_selection` | Agent ì„ íƒ | JSON | GPT-4o-mini |
| 2b| Planning | (Fallback) | `agent_selection_simple` | Agent ì„ íƒ (ê°„ì†Œí™”) | JSON | GPT-4o-mini |
| 3 | Execution | SearchExecutor.extract_keywords() | `keyword_extraction` | ê²€ìƒ‰ í‚¤ì›Œë“œ ì¶”ì¶œ | JSON | GPT-4o-mini |
| 4 | Execution | AnalysisExecutor.generate_insights() | `insight_generation` | ë°ì´í„° ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ | JSON | GPT-4o |
| 5 | Response | Supervisor.generate_response_node() | `response_synthesis` | ìµœì¢… ìì—°ì–´ ì‘ë‹µ ìƒì„± | Text | GPT-4o-mini |
| * | Error | (Any) | `error_response` | ì—ëŸ¬ ìƒí™© ì‘ë‹µ | Text | GPT-4o-mini |

### 3.2 íŒŒì¼ë³„ LLM í˜¸ì¶œ ìœ„ì¹˜

#### cognitive_agents/planning_agent.py
```python
# 1. ì˜ë„ ë¶„ì„
async def _analyze_with_llm(self, query: str):
    result = await self.llm_service.complete_json_async(
        prompt_name="intent_analysis",  # â† Prompt #1
        variables={"query": query},
        temperature=0.1
    )

# 2. Agent ì„ íƒ (Primary)
async def _select_agents_with_llm(self, intent_type, query, keywords):
    result = await self.llm_service.complete_json_async(
        prompt_name="agent_selection",  # â† Prompt #2
        variables={
            "query": query,
            "intent_type": intent_type.value,
            "keywords": keywords,
            "available_agents": {...}
        },
        temperature=0.1
    )

# 3. Agent ì„ íƒ (Fallback)
async def _select_agents_with_llm_simple(self, intent_type, query):
    result = await self.llm_service.complete_json_async(
        prompt_name="agent_selection_simple",  # â† Prompt #2b
        variables={"query": query, "intent_type": intent_type.value},
        temperature=0.3
    )
```

#### execution_agents/search_executor.py
```python
# 4. í‚¤ì›Œë“œ ì¶”ì¶œ
def extract_keywords(self, query: str):
    result = self.llm_service.complete_json(
        prompt_name="keyword_extraction",  # â† Prompt #3
        variables={"query": query},
        temperature=0.1
    )
```

#### execution_agents/analysis_executor.py
```python
# 5. ì¸ì‚¬ì´íŠ¸ ìƒì„±
async def generate_insights(self, query, search_results):
    result = await self.llm_service.complete_json_async(
        prompt_name="insight_generation",  # â† Prompt #4
        variables={
            "query": query,
            "search_results": search_results,
            "analysis_type": "comprehensive"
        },
        temperature=0.3
    )
```

#### supervisor/team_supervisor.py
```python
# 6. ìµœì¢… ì‘ë‹µ í•©ì„±
async def generate_response_node(self, state):
    answer = await self.planning_agent.llm_service.complete_async(
        prompt_name="response_synthesis",  # â† Prompt #5
        variables={
            "query": query,
            "search_results": {...},
            "analysis_results": {...}
        },
        temperature=0.3
    )
```

---

## 4. í”„ë¡¬í”„íŠ¸ ì¹´íƒˆë¡œê·¸

### 4.1 í”„ë¡¬í”„íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
llm_manager/prompts/
â”‚
â”œâ”€â”€ cognitive/                      # ì‚¬ê³ /ê³„íš ë‹¨ê³„ í”„ë¡¬í”„íŠ¸
â”‚   â”œâ”€â”€ intent_analysis.txt         # ì˜ë„ ë¶„ì„
â”‚   â”œâ”€â”€ agent_selection.txt         # Agent ì„ íƒ (ìƒì„¸)
â”‚   â”œâ”€â”€ agent_selection_simple.txt  # Agent ì„ íƒ (ê°„ì†Œí™”)
â”‚   â””â”€â”€ plan_generation.txt         # ì‹¤í–‰ ê³„íš ìƒì„± (ë¯¸ì‚¬ìš©)
â”‚
â”œâ”€â”€ execution/                      # ì‹¤í–‰ ë‹¨ê³„ í”„ë¡¬í”„íŠ¸
â”‚   â”œâ”€â”€ keyword_extraction.txt      # í‚¤ì›Œë“œ ì¶”ì¶œ
â”‚   â”œâ”€â”€ insight_generation.txt      # ì¸ì‚¬ì´íŠ¸ ìƒì„±
â”‚   â””â”€â”€ response_synthesis.txt      # ì‘ë‹µ í•©ì„±
â”‚
â””â”€â”€ common/                         # ê³µí†µ í”„ë¡¬í”„íŠ¸
    â””â”€â”€ error_response.txt          # ì—ëŸ¬ ì‘ë‹µ
```

### 4.2 ê° í”„ë¡¬í”„íŠ¸ ìƒì„¸

#### ğŸ“„ intent_analysis.txt

**ìœ„ì¹˜**: `prompts/cognitive/intent_analysis.txt`
**ì‚¬ìš© ìœ„ì¹˜**: `PlanningAgent._analyze_with_llm()`
**í˜¸ì¶œ ë¹ˆë„**: ì‚¬ìš©ì ìš”ì²­ë‹¹ 1íšŒ (Phase 1)

**ì…ë ¥ ë³€ìˆ˜**:
```python
{
    "query": str  # ì‚¬ìš©ì ì§ˆë¬¸
}
```

**ì¶œë ¥ í˜•ì‹**:
```json
{
    "intent": "LEGAL_CONSULT | MARKET_INQUIRY | LOAN_CONSULT | CONTRACT_CREATION | CONTRACT_REVIEW | COMPREHENSIVE | RISK_ANALYSIS | UNCLEAR | IRRELEVANT",
    "confidence": 0.0~1.0,
    "keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2", ...],
    "entities": {
        "location": "ê°•ë‚¨êµ¬",
        "price": "5ì–µ",
        "contract_type": "ì „ì„¸",
        ...
    },
    "reasoning": "ë¶„ë¥˜ ì´ìœ  ìƒì„¸ ì„¤ëª…"
}
```

**ì—­í• **: ì‚¬ìš©ì ì§ˆë¬¸ì„ 9ê°€ì§€ ì˜ë„ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ê³ , ì£¼ìš” í‚¤ì›Œë“œì™€ ì—”í‹°í‹°ë¥¼ ì¶”ì¶œ

---

#### ğŸ“„ agent_selection.txt

**ìœ„ì¹˜**: `prompts/cognitive/agent_selection.txt`
**ì‚¬ìš© ìœ„ì¹˜**: `PlanningAgent._select_agents_with_llm()`
**í˜¸ì¶œ ë¹ˆë„**: ì˜ë„ ë¶„ì„ í›„ 1íšŒ (Phase 1)

**ì…ë ¥ ë³€ìˆ˜**:
```python
{
    "query": str,           # ì‚¬ìš©ì ì§ˆë¬¸
    "intent_type": str,     # ë¶„ì„ëœ ì˜ë„
    "keywords": list,       # ì¶”ì¶œëœ í‚¤ì›Œë“œ
    "available_agents": {   # Agent ì •ë³´
        "search_team": {
            "capabilities": "ë²•ë¥  ê²€ìƒ‰, ë¶€ë™ì‚° ì‹œì„¸ ì¡°íšŒ...",
            "tools": ["legal_search", "market_data", ...],
            "use_cases": [...]
        },
        ...
    }
}
```

**ì¶œë ¥ í˜•ì‹**:
```json
{
    "selected_agents": ["search_team", "analysis_team"],
    "reasoning": "ì„ íƒ ì´ìœ : ë²•ë¥  ê²€ìƒ‰ê³¼ ì‹œì„¸ ë°ì´í„°ê°€ í•„ìš”í•˜ë©°, ë¶„ì„ì„ í†µí•´ ì¸ì‚¬ì´íŠ¸ ì œê³µ..."
}
```

**ì—­í• **: ì‚¬ìš© ê°€ëŠ¥í•œ Agent ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§ˆë¬¸ì— ê°€ì¥ ì í•©í•œ Agent ì¡°í•© ì„ íƒ

---

#### ğŸ“„ agent_selection_simple.txt

**ìœ„ì¹˜**: `prompts/cognitive/agent_selection_simple.txt`
**ì‚¬ìš© ìœ„ì¹˜**: `PlanningAgent._select_agents_with_llm_simple()` (Fallback)
**í˜¸ì¶œ ë¹ˆë„**: Primary ì‹¤íŒ¨ ì‹œ 1íšŒ

**ì…ë ¥ ë³€ìˆ˜**:
```python
{
    "query": str,
    "intent_type": str
}
```

**ì¶œë ¥ í˜•ì‹**:
```json
{
    "agents": ["search_team"]
}
```

**ì—­í• **: ê°„ì†Œí™”ëœ í”„ë¡¬í”„íŠ¸ë¡œ ë¹ ë¥¸ Agent ì„ íƒ (ë³µì¡í•œ ìƒí™© íŒë‹¨ ë¶ˆê°€)

---

#### ğŸ“„ keyword_extraction.txt

**ìœ„ì¹˜**: `prompts/execution/keyword_extraction.txt`
**ì‚¬ìš© ìœ„ì¹˜**: `SearchExecutor.extract_keywords()`
**í˜¸ì¶œ ë¹ˆë„**: ê²€ìƒ‰ ì‹¤í–‰ ì‹œ 1íšŒ (Phase 2)

**ì…ë ¥ ë³€ìˆ˜**:
```python
{
    "query": str  # ì‚¬ìš©ì ì§ˆë¬¸
}
```

**ì¶œë ¥ í˜•ì‹**:
```json
{
    "legal": ["ì „ì„¸", "ì„ëŒ€ì°¨", "ë³´ì¦ê¸ˆ"],
    "real_estate": ["ê°•ë‚¨êµ¬", "ì•„íŒŒíŠ¸", "ì‹œì„¸"],
    "loan": []
}
```

**ì—­í• **: ê²€ìƒ‰ ë„ë©”ì¸ë³„ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ì—¬ Tool í˜¸ì¶œì— í™œìš©

---

#### ğŸ“„ insight_generation.txt

**ìœ„ì¹˜**: `prompts/execution/insight_generation.txt`
**ì‚¬ìš© ìœ„ì¹˜**: `AnalysisExecutor.generate_insights()`
**í˜¸ì¶œ ë¹ˆë„**: ë¶„ì„ ì‹¤í–‰ ì‹œ 1íšŒ (Phase 2)

**ì…ë ¥ ë³€ìˆ˜**:
```python
{
    "query": str,
    "search_results": {
        "legal": [...],
        "market": [...],
        "loan": [...]
    },
    "analysis_type": "comprehensive"
}
```

**ì¶œë ¥ í˜•ì‹**:
```json
{
    "insights": [
        {
            "type": "legal_compliance",
            "content": "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ì œí•œ ì ìš©ë¨",
            "confidence": 0.95
        },
        {
            "type": "market_trend",
            "content": "ê°•ë‚¨êµ¬ ì „ì„¸ê°€ ìƒìŠ¹ ì¶”ì„¸",
            "confidence": 0.85
        }
    ],
    "recommendations": [
        "ê³„ì•½ ê°±ì‹  ì‹œ 5% ì¸ìƒ ì œí•œ í™•ì¸ í•„ìš”",
        "ì‹œì„¸ ìƒìŠ¹ ê³ ë ¤í•˜ì—¬ ì¡°ê¸° ê³„ì•½ ê²€í† "
    ],
    "risk_level": "low"
}
```

**ì—­í• **: ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ ì¸ì‚¬ì´íŠ¸ì™€ ì¶”ì²œì‚¬í•­ ìƒì„±

---

#### ğŸ“„ response_synthesis.txt

**ìœ„ì¹˜**: `prompts/execution/response_synthesis.txt`
**ì‚¬ìš© ìœ„ì¹˜**: `TeamBasedSupervisor.generate_response_node()`
**í˜¸ì¶œ ë¹ˆë„**: ìµœì¢… ì‘ë‹µ ìƒì„± ì‹œ 1íšŒ (Phase 4)

**ì…ë ¥ ë³€ìˆ˜**:
```python
{
    "query": str,
    "search_results": {...},
    "analysis_results": {...},
    "intent": str
}
```

**ì¶œë ¥ í˜•ì‹**: Text (ìì—°ì–´ ì‘ë‹µ)

**ì˜ˆì‹œ ì¶œë ¥**:
```
ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸ ì „ì„¸ì— ëŒ€í•´ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ã€ë²•ì  ì œí•œã€‘
ì „ì„¸ê¸ˆ ì¸ìƒì€ 5% ì´ë‚´ë¡œ ì œí•œë©ë‹ˆë‹¤ (ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°).

ã€ì‹œì„¸ ì •ë³´ã€‘
í˜„ì¬ ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸ ì „ì„¸ í‰ê·  ì‹œì„¸ëŠ” ì•½ 8ì–µì›ì´ë©°, ì „ë…„ ëŒ€ë¹„ 3% ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.

ã€ì£¼ì˜ì‚¬í•­ã€‘
- ê³„ì•½ ê°±ì‹  ì‹œ 5% ì¸ìƒ ì œí•œ í™•ì¸ í•„ìš”
- ì‹œì„¸ ìƒìŠ¹ ì¶”ì„¸ì´ë¯€ë¡œ ì¡°ê¸° ê³„ì•½ ê²€í†  ê¶Œì¥

ì¶”ê°€ ê¶ê¸ˆí•˜ì‹  ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”.
```

**ì—­í• **: ëª¨ë“  ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ ì‚¬ìš©ìê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ ìì—°ì–´ ì‘ë‹µ ìƒì„±

---

#### ğŸ“„ error_response.txt

**ìœ„ì¹˜**: `prompts/common/error_response.txt`
**ì‚¬ìš© ìœ„ì¹˜**: ì—ëŸ¬ ë°œìƒ ì‹œ ì „ì—­ì ìœ¼ë¡œ ì‚¬ìš©
**í˜¸ì¶œ ë¹ˆë„**: ì—ëŸ¬ ë°œìƒ ì‹œ

**ì…ë ¥ ë³€ìˆ˜**:
```python
{
    "error_type": str,
    "error_message": str,
    "user_query": str
}
```

**ì¶œë ¥ í˜•ì‹**: Text

**ì—­í• **: ì—ëŸ¬ ìƒí™©ì„ ì‚¬ìš©ìì—ê²Œ ì¹œì ˆí•˜ê²Œ ì„¤ëª…

---

## 5. Phaseë³„ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©

### Phase 1: Planning (ê³„íš ìˆ˜ë¦½)

```mermaid
graph TD
    A[ì‚¬ìš©ì ì§ˆë¬¸] --> B[PlanningAgent.analyze_intent]
    B --> C{LLM í˜¸ì¶œ #1}
    C -->|Prompt| D[intent_analysis.txt]
    D --> E[Intent Result]

    E --> F[PlanningAgent._suggest_agents]
    F --> G{LLM í˜¸ì¶œ #2}
    G -->|Prompt| H[agent_selection.txt]
    H --> I{ì„±ê³µ?}
    I -->|Yes| J[Selected Agents]
    I -->|No| K{LLM ì¬ì‹œë„}
    K -->|Prompt| L[agent_selection_simple.txt]
    L --> M{ì„±ê³µ?}
    M -->|Yes| J
    M -->|No| N[Safe Default Agents]

    J --> O[ExecutionPlan ìƒì„±]
    N --> O
```

**ì‚¬ìš© í”„ë¡¬í”„íŠ¸**:
1. âœ… `intent_analysis.txt` (í•„ìˆ˜)
2. âœ… `agent_selection.txt` (Primary)
3. âš ï¸ `agent_selection_simple.txt` (Fallback)

**íŠ¹ì§•**:
- LLM ê¸°ë°˜ ì˜ì‚¬ê²°ì • (ë™ì , ìœ ì—°)
- 2ë‹¨ê³„ Fallback ì „ëµ (í’ˆì§ˆ ìœ ì§€)
- ê³„íš ìƒì„±ì€ ë¡œì§ ê¸°ë°˜ (LLM ë¶ˆí•„ìš”)

---

### Phase 2: Execution (ì‹¤í–‰)

#### 2-1. SearchExecutor

```mermaid
graph TD
    A[ExecutionPlan] --> B[SearchExecutor.execute]
    B --> C{LLM í˜¸ì¶œ #3}
    C -->|Prompt| D[keyword_extraction.txt]
    D --> E[Keywords by Domain]

    E --> F[Tool í˜¸ì¶œ]
    F --> G[legal_search_tool]
    F --> H[market_data_tool]
    F --> I[loan_data_tool]

    G --> J[Search Results]
    H --> J
    I --> J
```

**ì‚¬ìš© í”„ë¡¬í”„íŠ¸**:
1. âœ… `keyword_extraction.txt` (ê²€ìƒ‰ ìµœì í™”)

**íŠ¹ì§•**:
- Tool í˜¸ì¶œ ì „ LLMìœ¼ë¡œ í‚¤ì›Œë“œ ì •ì œ
- Tool ìì²´ëŠ” LLM ì—†ì´ ì‘ë™ (DB ê²€ìƒ‰)

#### 2-2. AnalysisExecutor

```mermaid
graph TD
    A[Search Results] --> B[AnalysisExecutor.execute]
    B --> C{LLM í˜¸ì¶œ #4}
    C -->|Prompt| D[insight_generation.txt]
    D --> E[Insights + Recommendations]
```

**ì‚¬ìš© í”„ë¡¬í”„íŠ¸**:
1. âœ… `insight_generation.txt` (í•µì‹¬ ë¶„ì„)

**íŠ¹ì§•**:
- SearchExecutor ê²°ê³¼ë¥¼ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©
- GPT-4o ì‚¬ìš© (ê³ í’ˆì§ˆ ë¶„ì„ í•„ìš”)
- ì˜ì¡´ì„±: search â†’ analysis

---

### Phase 3: Aggregation (í†µí•©)

```mermaid
graph TD
    A[Team Results] --> B[StateManager.merge_team_results]
    B --> C[Merged State]
```

**ì‚¬ìš© í”„ë¡¬í”„íŠ¸**:
- âŒ LLM ì‚¬ìš© ì•ˆ í•¨ (ë°ì´í„° ë³‘í•©ë§Œ)

**íŠ¹ì§•**:
- ìˆœìˆ˜ ë¡œì§ ê¸°ë°˜
- State Pollution ë°©ì§€

---

### Phase 4: Response Generation (ì‘ë‹µ ìƒì„±)

```mermaid
graph TD
    A[Aggregated Results] --> B[Supervisor.generate_response_node]
    B --> C{LLM í˜¸ì¶œ #5}
    C -->|Prompt| D[response_synthesis.txt]
    D --> E[Natural Language Response]
    E --> F[ì‚¬ìš©ì]
```

**ì‚¬ìš© í”„ë¡¬í”„íŠ¸**:
1. âœ… `response_synthesis.txt` (ìµœì¢… ì¶œë ¥)

**íŠ¹ì§•**:
- ëª¨ë“  ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ ìì—°ì–´ë¡œ ë³€í™˜
- ì‚¬ìš©ì ì¹œí™”ì  í˜•ì‹ìœ¼ë¡œ ì¬êµ¬ì„±
- ì¶”ê°€ ì§ˆë¬¸ ìœ ë„

---

## 6. LLM Manager ì•„í‚¤í…ì²˜

### 6.1 LLMService ì‚¬ìš©ë²•

```python
from app.service_agent.llm_manager import LLMService

# ì´ˆê¸°í™”
llm_service = LLMService(llm_context=llm_context)

# JSON ì‘ë‹µ (ë™ê¸°)
result = llm_service.complete_json(
    prompt_name="intent_analysis",
    variables={"query": "ì „ì„¸ ê³„ì•½ì€?"},
    temperature=0.1,
    max_tokens=500
)

# JSON ì‘ë‹µ (ë¹„ë™ê¸°)
result = await llm_service.complete_json_async(
    prompt_name="agent_selection",
    variables={...}
)

# í…ìŠ¤íŠ¸ ì‘ë‹µ (ë¹„ë™ê¸°)
response = await llm_service.complete_async(
    prompt_name="response_synthesis",
    variables={...}
)
```

### 6.2 PromptManager ì‚¬ìš©ë²•

```python
from app.service_agent.llm_manager import PromptManager

# ì´ˆê¸°í™”
pm = PromptManager()

# í”„ë¡¬í”„íŠ¸ ë¡œë“œ
prompt = pm.get(
    prompt_name="intent_analysis",
    variables={"query": "ê°•ë‚¨êµ¬ ì „ì„¸"},
    category="cognitive"  # Optional
)

# ì‚¬ìš© ê°€ëŠ¥í•œ í”„ë¡¬í”„íŠ¸ ëª©ë¡
prompts = pm.list_prompts()
# {
#   "cognitive": ["intent_analysis", "agent_selection", ...],
#   "execution": ["keyword_extraction", ...],
#   "common": ["error_response"]
# }

# í”„ë¡¬í”„íŠ¸ ìœ íš¨ì„± ê²€ì¦
is_valid = pm.validate(
    prompt_name="intent_analysis",
    required_variables=["query"]
)

# ìºì‹œ ì´ˆê¸°í™” (í”„ë¡¬í”„íŠ¸ ì¬ë¡œë“œ)
pm.reload()
```

### 6.3 í”„ë¡¬í”„íŠ¸ íŒŒì¼ í˜•ì‹

#### TXT í˜•ì‹ (ê¶Œì¥)
```
ë‹¹ì‹ ì€ ë¶€ë™ì‚° AI ì‹œìŠ¤í…œì˜ ì˜ë„ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ì‚¬ìš©ì ì§ˆë¬¸: {query}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{{
    "intent": "...",
    "confidence": 0.0~1.0,
    "keywords": [...]
}}
```

#### YAML í˜•ì‹ (ë©”íƒ€ë°ì´í„° í¬í•¨)
```yaml
metadata:
  version: "1.0"
  author: "í™ˆì¦ˆëƒ¥ì¦ˆ"
  created: "2025-01-02"
  model: "gpt-4o-mini"
  temperature: 0.1

system_prompt: |
  ë‹¹ì‹ ì€ ë¶€ë™ì‚° AI ì‹œìŠ¤í…œì˜ ì˜ë„ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

  ì‚¬ìš©ì ì§ˆë¬¸: {query}

  ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
  {
      "intent": "...",
      "confidence": 0.0~1.0
  }
```

---

## 7. í”„ë¡¬í”„íŠ¸ ì‘ì„± ê°€ì´ë“œ

### 7.1 í”„ë¡¬í”„íŠ¸ ì‘ì„± ì›ì¹™

1. **ëª…í™•í•œ ì—­í•  ì •ì˜**
   ```
   âœ… ì¢‹ì€ ì˜ˆ: "ë‹¹ì‹ ì€ ë¶€ë™ì‚° AI ì‹œìŠ¤í…œì˜ ì˜ë„ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤."
   âŒ ë‚˜ìœ ì˜ˆ: "ì˜ë„ë¥¼ ë¶„ì„í•˜ì„¸ìš”."
   ```

2. **êµ¬ì²´ì ì¸ ì˜ˆì‹œ ì œê³µ**
   ```
   âœ… ì¢‹ì€ ì˜ˆ:
   - ì˜ˆì‹œ: "ê°•ë‚¨êµ¬ ì „ì„¸ ì‹œì„¸" â†’ MARKET_INQUIRY
   - ì˜ˆì‹œ: "ì „ì„¸ê¸ˆ ì¸ìƒ ì œí•œì€?" â†’ LEGAL_CONSULT

   âŒ ë‚˜ìœ ì˜ˆ: "ì ì ˆíˆ ë¶„ë¥˜í•˜ì„¸ìš”."
   ```

3. **ëª…í™•í•œ ì¶œë ¥ í˜•ì‹**
   ```
   âœ… ì¢‹ì€ ì˜ˆ:
   JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ:
   {
       "intent": "ì¹´í…Œê³ ë¦¬ëª…",
       "confidence": 0.0~1.0,
       "keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"]
   }

   âŒ ë‚˜ìœ ì˜ˆ: "JSONìœ¼ë¡œ ë‹µí•˜ì„¸ìš”."
   ```

4. **ë³€ìˆ˜ ì‚¬ìš©**
   ```python
   # {variable_name} í˜•ì‹ìœ¼ë¡œ ë³€ìˆ˜ ì •ì˜
   "ì‚¬ìš©ì ì§ˆë¬¸: {query}"
   "ë¶„ì„ íƒ€ì…: {analysis_type}"
   ```

### 7.2 í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸

```python
# llm_manager/test_llm_manager.py
import pytest
from app.service_agent.llm_manager import LLMService

def test_intent_analysis_prompt():
    llm_service = LLMService()

    result = llm_service.complete_json(
        prompt_name="intent_analysis",
        variables={"query": "ê°•ë‚¨êµ¬ ì „ì„¸ ì‹œì„¸"}
    )

    assert "intent" in result
    assert "confidence" in result
    assert result["intent"] in ["MARKET_INQUIRY", "COMPREHENSIVE"]
    assert 0.0 <= result["confidence"] <= 1.0
```

### 7.3 í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬

```bash
# Gitìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ ë³€ê²½ ì¶”ì 
git log prompts/cognitive/intent_analysis.txt

# í”„ë¡¬í”„íŠ¸ A/B í…ŒìŠ¤íŠ¸
# 1. ìƒˆ ë²„ì „ ì‘ì„±
prompts/cognitive/intent_analysis_v2.txt

# 2. ì½”ë“œì—ì„œ ì „í™˜
prompt_name = "intent_analysis_v2"  # ì‹¤í—˜ ë²„ì „

# 3. ì„±ëŠ¥ ë¹„êµ í›„ ê²°ì •
```

---

## 8. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 8.1 í”„ë¡¬í”„íŠ¸ ë¡œë“œ ì‹¤íŒ¨

**ì¦ìƒ**:
```
FileNotFoundError: Prompt file not found: intent_analysis
```

**í•´ê²°**:
1. íŒŒì¼ ì¡´ì¬ í™•ì¸
   ```bash
   ls llm_manager/prompts/cognitive/intent_analysis.txt
   ```

2. íŒŒì¼ ì´ë¦„ í™•ì¸ (í™•ì¥ì í¬í•¨)
   ```python
   # âŒ ì˜ëª»ëœ ì˜ˆ
   prompt_name="intent_analysis.txt"

   # âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
   prompt_name="intent_analysis"  # í™•ì¥ì ì œì™¸
   ```

3. ì¹´í…Œê³ ë¦¬ í™•ì¸
   ```python
   # ìë™ íƒìƒ‰ (ê¶Œì¥)
   pm.get(prompt_name="intent_analysis")

   # ìˆ˜ë™ ì§€ì •
   pm.get(prompt_name="intent_analysis", category="cognitive")
   ```

### 8.2 ë³€ìˆ˜ ì¹˜í™˜ ì‹¤íŒ¨

**ì¦ìƒ**:
```
KeyError: 'query'
Missing required variable query for prompt 'intent_analysis'
```

**í•´ê²°**:
1. í•„ìˆ˜ ë³€ìˆ˜ í™•ì¸
   ```python
   # í”„ë¡¬í”„íŠ¸ì— {query}ê°€ ìˆìœ¼ë©´ ë°˜ë“œì‹œ ì „ë‹¬
   llm_service.complete_json(
       prompt_name="intent_analysis",
       variables={"query": "ì „ì„¸ ê³„ì•½"}  # â† í•„ìˆ˜
   )
   ```

2. ë³€ìˆ˜ëª… ëŒ€ì†Œë¬¸ì ì¼ì¹˜
   ```python
   # í”„ë¡¬í”„íŠ¸: {query}
   # âœ… ì˜¬ë°”ë¦„
   variables={"query": "..."}

   # âŒ í‹€ë¦¼
   variables={"Query": "..."}  # ëŒ€ì†Œë¬¸ì ë¶ˆì¼ì¹˜
   ```

### 8.3 LLM ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜

**ì¦ìƒ**:
```
JSONDecodeError: Expecting value: line 1 column 1 (char 0)
```

**í•´ê²°**:
1. í”„ë¡¬í”„íŠ¸ì—ì„œ JSON í˜•ì‹ ê°•ì¡°
   ```
   âœ… ê°œì„ :
   "ë°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”. ì„¤ëª…ì€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”:"
   {
       "intent": "...",
       ...
   }
   ```

2. response_format ì§€ì •
   ```python
   llm_service.complete_json_async(
       prompt_name="intent_analysis",
       variables={...},
       response_format={"type": "json_object"}  # â† ê°•ì œ
   )
   ```

3. ì˜¨ë„ ë‚®ì¶”ê¸°
   ```python
   temperature=0.1  # ë” ì¼ê´€ëœ í˜•ì‹
   ```

### 8.4 LLM Agent ì„ íƒ ì‹¤íŒ¨

**ì¦ìƒ**:
ëª¨ë“  LLM ì‹œë„ê°€ ì‹¤íŒ¨í•˜ê³  Safe Default ì‚¬ìš©

**í•´ê²°**:
1. API í‚¤ í™•ì¸
   ```python
   echo $OPENAI_API_KEY
   ```

2. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
   ```python
   curl https://api.openai.com/v1/models
   ```

3. ë¡œê·¸ í™•ì¸
   ```python
   logger.warning("âš ï¸ Primary LLM agent selection failed: {e}")
   logger.warning("âš ï¸ Simplified LLM agent selection failed: {e}")
   ```

4. Fallback ë™ì‘ í™•ì¸
   ```python
   # Safe Defaultê°€ ì ì ˆí•œì§€ ê²€ì¦
   safe_defaults = {
       IntentType.UNCLEAR: ["search_team", "analysis_team"]  # í¬ê´„ì 
   }
   ```

---

## 9. ë¶€ë¡

### 9.1 í”„ë¡¬í”„íŠ¸ ëª©ë¡ (ë¹ ë¥¸ ì°¸ì¡°)

| í”„ë¡¬í”„íŠ¸ | ì¹´í…Œê³ ë¦¬ | ì…ë ¥ | ì¶œë ¥ | ìš©ë„ |
|---------|---------|------|------|------|
| intent_analysis | cognitive | query | JSON | ì˜ë„ ë¶„ì„ |
| agent_selection | cognitive | query, intent_type, keywords, available_agents | JSON | Agent ì„ íƒ |
| agent_selection_simple | cognitive | query, intent_type | JSON | Agent ì„ íƒ (ê°„ì†Œí™”) |
| keyword_extraction | execution | query | JSON | í‚¤ì›Œë“œ ì¶”ì¶œ |
| insight_generation | execution | query, search_results, analysis_type | JSON | ì¸ì‚¬ì´íŠ¸ ìƒì„± |
| response_synthesis | execution | query, search_results, analysis_results | Text | ìµœì¢… ì‘ë‹µ |
| error_response | common | error_type, error_message, user_query | Text | ì—ëŸ¬ ì‘ë‹µ |

### 9.2 Model ì‚¬ìš© í˜„í™©

| Phase | Prompt | Model | Temperature | Max Tokens |
|-------|--------|-------|-------------|------------|
| Planning | intent_analysis | GPT-4o-mini | 0.1 | 500 |
| Planning | agent_selection | GPT-4o-mini | 0.1 | 500 |
| Planning | agent_selection_simple | GPT-4o-mini | 0.3 | 300 |
| Execution | keyword_extraction | GPT-4o-mini | 0.1 | 300 |
| Execution | insight_generation | GPT-4o | 0.3 | 1000 |
| Response | response_synthesis | GPT-4o-mini | 0.3 | 1500 |

### 9.3 ë¹„ìš© ìµœì í™” íŒ

1. **ìºì‹± í™œìš©**
   - PromptManagerê°€ í”„ë¡¬í”„íŠ¸ ìë™ ìºì‹±
   - ë™ì¼ í”„ë¡¬í”„íŠ¸ ë°˜ë³µ ë¡œë“œ ì‹œ íŒŒì¼ I/O ì—†ìŒ

2. **ì˜¨ë„ ì„¤ì •**
   - ë¶„ë¥˜/ì¶”ì¶œ: temperature=0.1 (ì¼ê´€ì„±)
   - ìƒì„±/í•©ì„±: temperature=0.3 (ì°½ì˜ì„±)

3. **Model ì„ íƒ**
   - ë‹¨ìˆœ ì‘ì—…: GPT-4o-mini (ì €ë ´)
   - ë³µì¡ ë¶„ì„: GPT-4o (ê³ í’ˆì§ˆ)

4. **í† í° ì œí•œ**
   - max_tokens ì ì ˆíˆ ì„¤ì •
   - ë¶ˆí•„ìš”í•œ ì¥ë¬¸ ìƒì„± ë°©ì§€

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| 2025-10-05 | 1.0 | ì´ˆê¸° ì‘ì„± |

---

**ë¬¸ì˜**: ì‹œìŠ¤í…œ ê°œì„  ì œì•ˆì´ë‚˜ ì§ˆë¬¸ì€ ì´ìŠˆë¡œ ë“±ë¡í•´ ì£¼ì„¸ìš”.
