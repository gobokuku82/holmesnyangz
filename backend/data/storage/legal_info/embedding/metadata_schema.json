{
  "schema_version": "1.0",
  "description": "ChromaDB 메타데이터 표준 스키마 - 법령 문서 임베딩용",
  "last_updated": "2025-10-01",

  "required_fields": {
    "doc_type": {
      "type": "string",
      "description": "문서 타입",
      "allowed_values": ["법률", "시행령", "시행규칙", "대법원규칙", "용어집", "기타"],
      "extraction_method": "파일명에서 자동 추출",
      "examples": [
        "공인중개사법(법률).json → 법률",
        "부동산거래신고법 시행령.json → 시행령",
        "부동산_용어_95가지.json → 용어집"
      ]
    },
    "title": {
      "type": "string",
      "description": "법령 제목 (통합 필드)",
      "source_fields": ["law_title", "decree_title", "rule_title", "glossary_title"],
      "normalization": "약칭 제거 (예: ' ( 약칭:...' 부분 삭제)",
      "examples": [
        "주택임대차보호법",
        "부동산 거래신고 등에 관한 법률 시행령",
        "부동산 용어 95가지"
      ]
    },
    "number": {
      "type": "string",
      "description": "법령 번호 (통합 필드)",
      "source_fields": ["law_number", "decree_number", "rule_number"],
      "format": "제XXXXX호",
      "examples": ["제19356호", "제35485호", "제01294호"]
    },
    "enforcement_date": {
      "type": "string",
      "description": "시행일",
      "format": "YYYY. MM. DD.",
      "examples": ["2023. 7. 19.", "2025. 4. 29.", "2024. 1. 1."]
    },
    "category": {
      "type": "string",
      "description": "카테고리 (폴더명 기반)",
      "allowed_values": [
        "1_공통 매매_임대차",
        "2_임대차_전세_월세",
        "3_공급_및_관리_매매_분양",
        "4_기타"
      ],
      "extraction_method": "폴더명에서 자동 추출"
    },
    "source_file": {
      "type": "string",
      "description": "원본 청킹 파일명",
      "examples": [
        "주택임대차보호법(법률)(제19356호)(20230719)_chunked.json",
        "부동산_용어_95가지_chunked.json"
      ]
    },
    "article_number": {
      "type": "string",
      "description": "조항 번호",
      "format": "제X조 또는 제X조의Y",
      "examples": ["제1조", "제3조의2", "제10조"]
    },
    "article_title": {
      "type": "string",
      "description": "조항 제목",
      "examples": ["목적", "정의", "대항력 등"]
    },
    "chunk_index": {
      "type": "integer",
      "description": "동일 조항 내 청크 순번 (0부터 시작)",
      "calculation": "title + article_number로 그룹화 후 순번 부여",
      "examples": [0, 1, 2]
    },
    "is_deleted": {
      "type": "boolean",
      "description": "삭제된 조항 여부",
      "default": false
    }
  },

  "recommended_fields": {
    "chapter": {
      "type": "string",
      "description": "장 번호",
      "format": "제X장",
      "examples": ["제1장", "제2장", "제3장"],
      "condition": "원본 메타데이터에 존재할 때만 포함"
    },
    "chapter_title": {
      "type": "string",
      "description": "장 제목",
      "examples": ["총칙", "벌칙", "보칙"],
      "condition": "원본 메타데이터에 존재할 때만 포함"
    },
    "section": {
      "type": "string",
      "description": "절 번호",
      "format": "제X절",
      "examples": ["제1절", "제2절"],
      "condition": "원본 메타데이터에 존재할 때만 포함"
    },
    "abbreviation": {
      "type": "string",
      "description": "법령 약칭",
      "examples": ["주임법", "부동산거래신고법"],
      "condition": "원본 메타데이터에 존재하고 비어있지 않을 때만 포함"
    }
  },

  "optional_fields": {
    "is_tenant_protection": {
      "type": "boolean",
      "description": "임차인 보호 관련 조항",
      "condition": "true일 때만 필드 포함",
      "usage": "주택임대차보호법 조항에 주로 사용"
    },
    "is_tax_related": {
      "type": "boolean",
      "description": "세금 관련 조항",
      "condition": "true일 때만 필드 포함"
    },
    "is_delegation": {
      "type": "boolean",
      "description": "위임 조항 (다른 법령 참조)",
      "condition": "true일 때만 필드 포함",
      "usage": "「다른 법령」에 따라... 형태의 조항"
    },
    "is_penalty_related": {
      "type": "boolean",
      "description": "벌칙 관련 조항",
      "condition": "true일 때만 필드 포함"
    },
    "other_law_references": {
      "type": "string",
      "description": "다른 법령 참조 목록 (JSON 문자열)",
      "original_type": "array",
      "storage_format": "JSON.stringify() 결과",
      "reason": "ChromaDB는 배열 타입 메타데이터 미지원",
      "examples": [
        "[\"「주택법」\", \"「건축법」\", \"「민법」\"]",
        "[\"「공공주택 특별법」\"]"
      ],
      "condition": "원본 메타데이터에 배열이 존재하고 비어있지 않을 때만 포함"
    },
    "term_name": {
      "type": "string",
      "description": "용어명 (용어집 전용)",
      "examples": ["매도", "매수", "가계약금"],
      "condition": "용어집 문서일 때만 포함"
    },
    "term_category": {
      "type": "string",
      "description": "용어 카테고리 (용어집 전용)",
      "examples": ["매매거래", "임대차", "세금"],
      "condition": "용어집 문서일 때만 포함"
    },
    "term_number": {
      "type": "integer",
      "description": "용어 번호 (용어집 전용)",
      "examples": [1, 2, 3],
      "condition": "용어집 문서일 때만 포함"
    }
  },

  "normalization_rules": {
    "title_unification": {
      "description": "법률/시행령/시행규칙/용어집 제목을 title 필드로 통합",
      "priority_order": ["law_title", "decree_title", "rule_title", "glossary_title"],
      "fallback": "Unknown"
    },
    "abbreviation_removal": {
      "description": "제목에서 약칭 표기 제거",
      "pattern": " ( 약칭:.*",
      "example": "부동산 거래신고 등에 관한 법률 시행령 ( 약칭: 부동산거래신고법 시행령 → 부동산 거래신고 등에 관한 법률 시행령"
    },
    "chunk_index_assignment": {
      "description": "동일 조항이 여러 청크로 나뉜 경우 순번 부여",
      "grouping_key": "title + article_number",
      "index_start": 0,
      "example": {
        "주택임대차보호법||제3조": [
          {"id": "article_3", "chunk_index": 0},
          {"id": "article_3_continued", "chunk_index": 1}
        ]
      }
    },
    "array_to_json_string": {
      "description": "배열 타입을 JSON 문자열로 변환 (ChromaDB 제약)",
      "fields": ["other_law_references"],
      "method": "json.dumps(array, ensure_ascii=False)",
      "retrieval": "json.loads(metadata['other_law_references'])"
    }
  },

  "validation_rules": {
    "required_field_check": {
      "description": "모든 필수 필드가 존재하는지 확인",
      "fields": [
        "doc_type", "title", "number", "enforcement_date",
        "category", "source_file", "article_number",
        "article_title", "chunk_index", "is_deleted"
      ]
    },
    "unknown_title_check": {
      "description": "Unknown title 문서가 없는지 확인",
      "target": "0개",
      "query": "collection.get(where={'title': 'Unknown'})"
    },
    "doc_type_distribution": {
      "description": "doc_type 분포가 정상 범위인지 확인",
      "expected": {
        "법률": "35-45%",
        "시행령": "20-30%",
        "시행규칙": "12-20%",
        "대법원규칙": "10-15%",
        "용어집": "3-7%",
        "기타": "0-3%"
      }
    },
    "category_distribution": {
      "description": "4개 카테고리 모두 존재하는지 확인",
      "required_categories": [
        "1_공통 매매_임대차",
        "2_임대차_전세_월세",
        "3_공급_및_관리_매매_분양",
        "4_기타"
      ]
    }
  },

  "embedding_configuration": {
    "model": "kure_v1",
    "model_path": "backend/models/kure_v1",
    "embedding_dimension": 1024,
    "batch_size": 100,
    "collection_name": "korean_legal_documents",
    "distance_metric": "cosine"
  }
}
