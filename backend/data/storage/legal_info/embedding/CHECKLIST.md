# ì„ë² ë”© ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë‚´ì¼ ì‘ì—… ì‹œì‘ ì „ì— ìˆœì„œëŒ€ë¡œ í™•ì¸í•˜ì„¸ìš”.

## âœ… Phase 1: ì‚¬ì „ ì¤€ë¹„ (5ë¶„)

### 1-1. ì‚¬ì „ ì ê²€ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```bash
python backend/data/storage/legal_info/embedding/pre_check.py
```

**í™•ì¸ ì‚¬í•­:**
- [ ] Python 3.8+ ë²„ì „ í™•ì¸
- [ ] chromadb, sentence-transformers íŒ¨í‚¤ì§€ ì„¤ì¹˜ë¨
- [ ] ì²­í‚¹ íŒŒì¼ 28ê°œ ì¡´ì¬
- [ ] ì„ë² ë”© ëª¨ë¸ (kure_v1) ì¡´ì¬
- [ ] ë””ìŠ¤í¬ ì—¬ìœ  ê³µê°„ 1GB+

**ë¬¸ì œ ë°œìƒ ì‹œ**: `troubleshooting.md` ì°¸ì¡°

---

### 1-2. ê¸°ì¡´ ì‹œìŠ¤í…œ ë°±ì—… (ì„ íƒì‚¬í•­)
```bash
# ChromaDB ë°±ì—…
xcopy backend\data\storage\legal_info\chroma_db backend\data\storage\legal_info\chroma_db_backup_20251002\ /E /I /H /Y

# SQLite ë°±ì—…
copy backend\data\storage\legal_info\legal_metadata.db backend\data\storage\legal_info\legal_metadata_backup_20251002.db
```

- [ ] ChromaDB ë°±ì—… ì™„ë£Œ (ì„ íƒì‚¬í•­)
- [ ] SQLite ë°±ì—… ì™„ë£Œ (ì„ íƒì‚¬í•­)

---

## âœ… Phase 2: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (2ë¶„)

### 2-1. í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹¤í–‰ (1ê°œ ì¹´í…Œê³ ë¦¬ë§Œ)
```bash
python backend/data/storage/legal_info/embedding/embed_legal_documents.py --test
```

**ì˜ˆìƒ ê²°ê³¼:**
```
âœ… ChromaDB ì¬ì„ë² ë”© ì™„ë£Œ!
ğŸ“Š ì²˜ë¦¬ í†µê³„:
   - ì²˜ë¦¬ íŒŒì¼: 5ê°œ
   - ì„ë² ë”© ë¬¸ì„œ: 250ê°œ
   - ì†Œìš” ì‹œê°„: 30ì´ˆ

ğŸ“ˆ ì¹´í…Œê³ ë¦¬ë³„ í†µê³„:
   - 2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸: 250ê°œ

ğŸ” ì„ë² ë”© ê²°ê³¼ ê²€ì¦ ì¤‘...
âœ… ì „ì²´ ë¬¸ì„œ ê°œìˆ˜: 250
âš ï¸ Unknown title ë¬¸ì„œ: 0ê°œ (0.0%)

ğŸ“Š doc_type ë¶„í¬:
   - ë²•ë¥ : 100ê°œ (40.0%)
   - ì‹œí–‰ë ¹: 80ê°œ (32.0%)
   - ì‹œí–‰ê·œì¹™: 70ê°œ (28.0%)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„±ê³µ
- [ ] Unknown title: **0ê°œ** (ì¤‘ìš”!)
- [ ] doc_type ë¶„í¬ ì •ìƒ (ë²•ë¥ /ì‹œí–‰ë ¹/ì‹œí–‰ê·œì¹™ ëª¨ë‘ ì¡´ì¬)
- [ ] ì—ëŸ¬ ì—†ìŒ

**âŒ ì‹¤íŒ¨ ì‹œ**:
- `troubleshooting.md` ì°¸ì¡°
- ë¡œê·¸ í™•ì¸ í›„ ë¬¸ì œ í•´ê²°
- ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

---

### 2-2. ê²€ì¦ ê²°ê³¼ í™•ì¸
ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” `verify_embedding()` ê²°ê³¼ í™•ì¸:

- [ ] Unknown title ê°œìˆ˜: 0ê°œ
- [ ] doc_type ë¶„í¬ í™•ì¸
- [ ] ì¹´í…Œê³ ë¦¬ ë¶„í¬ í™•ì¸
- [ ] ìƒ˜í”Œ ë©”íƒ€ë°ì´í„° ì •ìƒ

---

## âœ… Phase 3: ì „ì²´ ì¬ì„ë² ë”© (5ë¶„)

**âš ï¸ ì£¼ì˜**: í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí•œ ê²½ìš°ì—ë§Œ ì§„í–‰!

### 3-1. ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
ChromaDB ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ëª¨ë‘ ì¢…ë£Œ:

- [ ] LangGraph ì—ì´ì „íŠ¸ ì¤‘ì§€
- [ ] Jupyter Notebook ì»¤ë„ ì¬ì‹œì‘
- [ ] ë‹¤ë¥¸ Python ìŠ¤í¬ë¦½íŠ¸ ì¢…ë£Œ

---

### 3-2. ì „ì²´ ì¬ì„ë² ë”© ì‹¤í–‰
```bash
python backend/data/storage/legal_info/embedding/embed_legal_documents.py --full
```

**ì˜ˆìƒ ê²°ê³¼:**
```
âœ… ChromaDB ì¬ì„ë² ë”© ì™„ë£Œ!
ğŸ“Š ì²˜ë¦¬ í†µê³„:
   - ì²˜ë¦¬ íŒŒì¼: 28ê°œ
   - ì„ë² ë”© ë¬¸ì„œ: 1700ê°œ
   - ì†Œìš” ì‹œê°„: 90-120ì´ˆ

ğŸ“ˆ ì¹´í…Œê³ ë¦¬ë³„ í†µê³„:
   - 1_ê³µí†µ ë§¤ë§¤_ì„ëŒ€ì°¨: 750ê°œ
   - 2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸: 250ê°œ
   - 3_ê³µê¸‰_ë°_ê´€ë¦¬_ë§¤ë§¤_ë¶„ì–‘: 520ê°œ
   - 4_ê¸°íƒ€: 180ê°œ

ğŸ” ì„ë² ë”© ê²°ê³¼ ê²€ì¦ ì¤‘...
âœ… ì „ì²´ ë¬¸ì„œ ê°œìˆ˜: 1700
âš ï¸ Unknown title ë¬¸ì„œ: 0ê°œ (0.0%)

ğŸ“Š doc_type ë¶„í¬:
   - ë²•ë¥ : 666ê°œ (39.2%)
   - ì‹œí–‰ë ¹: 426ê°œ (25.1%)
   - ì‹œí–‰ê·œì¹™: 268ê°œ (15.8%)
   - ëŒ€ë²•ì›ê·œì¹™: 225ê°œ (13.2%)
   - ìš©ì–´ì§‘: 92ê°œ (5.4%)
   - ê¸°íƒ€: 23ê°œ (1.4%)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] ì „ì²´ ì‹¤í–‰ ì„±ê³µ
- [ ] ì²˜ë¦¬ íŒŒì¼: 28ê°œ
- [ ] ì„ë² ë”© ë¬¸ì„œ: 1600-1800ê°œ ì‚¬ì´
- [ ] Unknown title: **0ê°œ** (ë§¤ìš° ì¤‘ìš”!)
- [ ] doc_type ë¶„í¬ ì •ìƒ
- [ ] 4ê°œ ì¹´í…Œê³ ë¦¬ ëª¨ë‘ ì¡´ì¬

---

## âœ… Phase 4: ìµœì¢… ê²€ì¦ (3ë¶„)

### 4-1. ChromaDB ì§ì ‘ í™•ì¸
```python
import chromadb

client = chromadb.PersistentClient(path="backend/data/storage/legal_info/chroma_db")
collection = client.get_collection("korean_legal_documents")

# ì „ì²´ ê°œìˆ˜
print(f"ì „ì²´ ë¬¸ì„œ: {collection.count()}ê°œ")

# Unknown í™•ì¸
unknown = collection.get(where={"title": "Unknown"}, limit=1000)
print(f"Unknown: {len(unknown['ids'])}ê°œ")

# ìƒ˜í”Œ í™•ì¸
sample = collection.get(limit=3, include=["metadatas"])
for meta in sample['metadatas']:
    print(f"- {meta['title']} ({meta['doc_type']}) / {meta['category']}")
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] ì „ì²´ ë¬¸ì„œ ê°œìˆ˜: 1600-1800ê°œ
- [ ] Unknown: 0ê°œ
- [ ] ìƒ˜í”Œ ë©”íƒ€ë°ì´í„° ì •ìƒ (title, doc_type, category ëª¨ë‘ ì¡´ì¬)

---

### 4-2. ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
```python
from backend.app.service.tools.legal_search_tool import LegalSearchTool
import asyncio

tool = LegalSearchTool()

# í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ ê²€ìƒ‰
result = await tool.search("ì „ì„¸ê¸ˆ ë°˜í™˜")
print(f"ê²°ê³¼ ê°œìˆ˜: {len(result['data'])}")
print(f"ì²« ë²ˆì§¸ ê²°ê³¼: {result['data'][0]['law_title']}")

# í…ŒìŠ¤íŠ¸ 2: ì¹´í…Œê³ ë¦¬ í•„í„°
result = await tool.search("ì„ì°¨ì¸ ë³´í˜¸", params={"category": "2_ì„ëŒ€ì°¨_ì „ì„¸_ì›”ì„¸"})
print(f"í•„í„°ë§ ê²°ê³¼: {len(result['data'])}ê°œ")

# í…ŒìŠ¤íŠ¸ 3: doc_type í•„í„°
result = await tool.search("ê³µì¸ì¤‘ê°œì‚¬", params={"doc_type": "ë²•ë¥ "})
print(f"ë²•ë¥ ë§Œ ê²€ìƒ‰: {len(result['data'])}ê°œ")
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] ê¸°ë³¸ ê²€ìƒ‰ ì‘ë™
- [ ] ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ì‘ë™
- [ ] doc_type í•„í„°ë§ ì‘ë™
- [ ] Unknown ê´€ë ¨ ì—ëŸ¬ ì—†ìŒ

---

### 4-3. 50ê°œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
python backend/app/service/tests/hard_query_test_50.py
```

**ì˜ˆìƒ ê²°ê³¼:**
```
ì„±ê³µë¥ : 40+/50 (80%+)
ë²•ë ¹ ë§¤ì¹­ë¥ : 35+/50 (70%+)
ì¹´í…Œê³ ë¦¬ ë§¤ì¹­ë¥ : 45+/50 (90%+)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] ì„±ê³µë¥ : 80% ì´ìƒ (40ê°œ+)
- [ ] ë²•ë ¹ ë§¤ì¹­ë¥ : 70% ì´ìƒ (35ê°œ+)
- [ ] Unknown ì—ëŸ¬ ì—†ìŒ

**âŒ ì„±ê³µë¥ ì´ ë‚®ì€ ê²½ìš° (<60%)**:
- ChromaDB ë¬¸ì œê°€ ì•„ë‹ˆë¼ LLM í”„ë¡¬í”„íŠ¸ ë¬¸ì œì¼ ìˆ˜ ìˆìŒ
- `SearchAgent` í”„ë¡¬í”„íŠ¸ ê°œì„  í•„ìš”
- ì¹´í…Œê³ ë¦¬ ì„ íƒ ë¡œì§ ê°œì„  í•„ìš”

---

## âœ… Phase 5: ì™„ë£Œ ë° ì •ë¦¬ (1ë¶„)

### 5-1. ìµœì¢… í™•ì¸
- [ ] Unknown title: 0ê°œ í™•ì¸
- [ ] ì „ì²´ ë¬¸ì„œ ê°œìˆ˜: ì •ìƒ ë²”ìœ„
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥: ì •ìƒ ì‘ë™
- [ ] í…ŒìŠ¤íŠ¸ ì„±ê³µë¥ : ëª©í‘œ ë‹¬ì„±

---

### 5-2. ë¬¸ì„œ ì—…ë°ì´íŠ¸
```markdown
# Information_for_legal_info_data.md ì—…ë°ì´íŠ¸

## ChromaDB ìƒíƒœ (2025-10-02 ì—…ë°ì´íŠ¸)
- ì „ì²´ ë¬¸ì„œ: 1700ê°œ
- Unknown ë¬¸ì„œ: 0ê°œ âœ…
- ì¬ì„ë² ë”© ì™„ë£Œ: 2025-10-02

## í‘œì¤€ ë©”íƒ€ë°ì´í„° ìŠ¤í‚¤ë§ˆ ì ìš©
- title í•„ë“œ í†µí•© (law_title/decree_title/rule_title â†’ title)
- doc_type ìë™ ì¶”ì¶œ
- category ìë™ ì¶”ì¶œ
- chunk_index ìë™ ë¶€ì—¬
```

- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ

---

### 5-3. ë°±ì—… ì •ë¦¬ (ì„ íƒì‚¬í•­)
```bash
# ì¬ì„ë² ë”© ì„±ê³µ ì‹œ ì´ì „ ë°±ì—… ì‚­ì œ
rmdir /s backend\data\storage\legal_info\chroma_db_backup_YYYYMMDD
```

- [ ] ë°±ì—… ì •ë¦¬ ì™„ë£Œ (ì„ íƒì‚¬í•­)

---

## ğŸ“Š ì„±ê³µ ê¸°ì¤€ ìš”ì•½

| í•­ëª© | í˜„ì¬ (Before) | ëª©í‘œ (After) | í™•ì¸ |
|-----|--------------|-------------|-----|
| Unknown ë¬¸ì„œ | 1034ê°œ (60%) | **0ê°œ (0%)** | [ ] |
| ì „ì²´ ë¬¸ì„œ | 1700ê°œ | 1700ê°œ | [ ] |
| í…ŒìŠ¤íŠ¸ ì„±ê³µë¥  | 54% | **80%+** | [ ] |
| ë²•ë ¹ ë§¤ì¹­ë¥  | 30% | **70%+** | [ ] |
| ì¹´í…Œê³ ë¦¬ í•„í„° | ë¶ˆì•ˆì • | **ì •ìƒ** | [ ] |
| doc_type í•„í„° | ì—†ìŒ | **ì •ìƒ** | [ ] |

---

## ğŸš¨ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ê³„íš

### ë¡¤ë°± ì¡°ê±´
- Unknown ë¬¸ì„œê°€ 100ê°œ ì´ìƒ
- ì „ì²´ ë¬¸ì„œê°€ 1000ê°œ ë¯¸ë§Œ
- í…ŒìŠ¤íŠ¸ ì„±ê³µë¥ ì´ 40% ë¯¸ë§Œ

### ë¡¤ë°± ë°©ë²•
```bash
# 1. ê¸°ì¡´ ChromaDB ì‚­ì œ
rmdir /s backend\data\storage\legal_info\chroma_db

# 2. ë°±ì—… ë³µì›
xcopy backend\data\storage\legal_info\chroma_db_backup_20251002\ backend\data\storage\legal_info\chroma_db\ /E /I /H /Y
```

---

## ğŸ“ ì™„ë£Œ í›„ ì‘ì—…

ì¬ì„ë² ë”© ì™„ë£Œ ë° ê²€ì¦ ì„±ê³µ í›„:

1. **ì´ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ë£Œ í‘œì‹œ**
   - ëª¨ë“  [ ]ë¥¼ [x]ë¡œ ë³€ê²½

2. **ê²°ê³¼ ê¸°ë¡**
   - ìµœì¢… ë¬¸ì„œ ê°œìˆ˜:
   - Unknown ê°œìˆ˜:
   - í…ŒìŠ¤íŠ¸ ì„±ê³µë¥ :
   - ì†Œìš” ì‹œê°„:

3. **ë‹¤ìŒ ë‹¨ê³„**
   - [ ] SQLite DB ì¬ìƒì„± (ì„ íƒì‚¬í•­)
   - [ ] SearchAgent í”„ë¡¬í”„íŠ¸ ê°œì„  (ì„ íƒì‚¬í•­)
   - [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ê³„íš ìˆ˜ë¦½
