â— ğŸ” ì‚¬ìš©ì ì§ˆì˜ â†’ ì¶œë ¥ê¹Œì§€ ì „ì²´ ì½”ë“œ ì—°ê²°ì  ë¶„ì„

  ğŸ“Œ ì‹œì‘ì : ì‚¬ìš©ìê°€ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜

  # ì‚¬ìš©ì ì½”ë“œ (ì˜ˆìƒ)
  from supervisor import RealEstateSupervisor

  supervisor = RealEstateSupervisor()
  result = await supervisor.process_query(
      query="ê°•ë‚¨ì—­ ê·¼ì²˜ 30í‰ëŒ€ ì•„íŒŒíŠ¸ ë§¤ë§¤ ì‹œì„¸",
      user_id="user123",
      session_id="session456"
  )

  ---
  ğŸ¯ ì „ì²´ ì‹¤í–‰ íë¦„ (ì½”ë“œ ì—°ê²°ì )

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1ï¸âƒ£ RealEstateSupervisor.__init__()                         â”‚
  â”‚    ğŸ“ supervisor/supervisor.py:39-48                       â”‚
  â”‚    â†“ ìƒì†: BaseAgent.__init__()                             â”‚
  â”‚    ğŸ“ core/base_agent.py:31-53                             â”‚
  â”‚    â””â”€ self._build_graph() í˜¸ì¶œ                              â”‚
  â”‚       ğŸ“ supervisor/supervisor.py:59-130                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 2ï¸âƒ£ supervisor.process_query()                               â”‚
  â”‚    ğŸ“ supervisor/supervisor.py:173-206                       â”‚
  â”‚    â†“                                                         â”‚
  â”‚    input_data = {"query": ..., "user_id": ..., ...}        â”‚
  â”‚    â†“                                                         â”‚
  â”‚    result = await self.execute(input_data, config)          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 3ï¸âƒ£ BaseAgent.execute()                                      â”‚
  â”‚    ğŸ“ core/base_agent.py:259-260 (ë©”ì„œë“œ ì‹œì‘)              â”‚
  â”‚                                                              â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 3-A. ì…ë ¥ ê²€ì¦                                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ base_agent.py:276                           â”‚        â”‚
  â”‚    â”‚ if not await self._validate_input(input_data) â”‚        â”‚
  â”‚    â”‚    â†“ í˜¸ì¶œ                                      â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:132-155                       â”‚        â”‚
  â”‚    â”‚    (_validate_input ì˜¤ë²„ë¼ì´ë“œ)               â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“                                                   â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 3-B. ì´ˆê¸° State ìƒì„±                          â”‚        â”‚
  â”‚    â”‚ ğŸ“ base_agent.py:284                           â”‚        â”‚
  â”‚    â”‚ initial_state = self._create_initial_state()  â”‚        â”‚
  â”‚    â”‚    â†“ í˜¸ì¶œ                                      â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:157-171                       â”‚        â”‚
  â”‚    â”‚    (_create_initial_state ì˜¤ë²„ë¼ì´ë“œ)         â”‚        â”‚
  â”‚    â”‚    â†“ ë‚´ë¶€ í˜¸ì¶œ                                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ core/states.py:290-325                      â”‚        â”‚
  â”‚    â”‚    (create_supervisor_initial_state)          â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“                                                   â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 3-C. Context ìƒì„±                              â”‚        â”‚
  â”‚    â”‚ ğŸ“ base_agent.py:287                           â”‚        â”‚
  â”‚    â”‚ context = self._create_context(input_data)    â”‚        â”‚
  â”‚    â”‚    â†“ í˜¸ì¶œ (BaseAgent ê¸°ë³¸ êµ¬í˜„)               â”‚        â”‚
  â”‚    â”‚ ğŸ“ base_agent.py:105-125                       â”‚        â”‚
  â”‚    â”‚    â†“ ë‚´ë¶€ í˜¸ì¶œ                                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ core/context.py:74-111                      â”‚        â”‚
  â”‚    â”‚    (create_agent_context)                     â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“                                                   â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 3-D. Config ì¤€ë¹„                               â”‚        â”‚
  â”‚    â”‚ ğŸ“ base_agent.py:290-298                       â”‚        â”‚
  â”‚    â”‚ config["configurable"]["thread_id"] = ...     â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“                                                   â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 3-E. Workflow ì»´íŒŒì¼ & ì‹¤í–‰                    â”‚        â”‚
  â”‚    â”‚ ğŸ“ base_agent.py:310-324                       â”‚        â”‚
  â”‚    â”‚ app = self.workflow.compile(checkpointer)     â”‚        â”‚
  â”‚    â”‚ result = await app.ainvoke(                   â”‚        â”‚
  â”‚    â”‚     initial_state,                            â”‚        â”‚
  â”‚    â”‚     config=config,                            â”‚        â”‚
  â”‚    â”‚     context=context                           â”‚        â”‚
  â”‚    â”‚ )                                             â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 4ï¸âƒ£ LangGraph StateGraph ì‹¤í–‰                                â”‚
  â”‚    (app.ainvoke ë‚´ë¶€ - LangGraph í”„ë ˆì„ì›Œí¬)                â”‚
  â”‚                                                              â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 4-A. ì‹œì‘ì : analyze_intent                    â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:128 (set_entry_point)         â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:84 (add_node)                 â”‚        â”‚
  â”‚    â”‚    â†“ ë…¸ë“œ í•¨ìˆ˜ ì‹¤í–‰                            â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor/intent_analyzer.py:70-115        â”‚        â”‚
  â”‚    â”‚    async def analyze_intent_node(state, runtime)â”‚       â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    ctx = await runtime.context()  â† Context ì ‘ê·¼â”‚       â”‚
  â”‚    â”‚    query = state["query"]         â† State ì½ê¸° â”‚       â”‚
  â”‚    â”‚    â†“ LLM í˜¸ì¶œ                                  â”‚        â”‚
  â”‚    â”‚ ğŸ“ intent_analyzer.py:17-67                    â”‚        â”‚
  â”‚    â”‚    await call_llm_for_intent(query, api_key)  â”‚        â”‚
  â”‚    â”‚    â†“ í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸°                         â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor/prompts.py:11-42                 â”‚        â”‚
  â”‚    â”‚    INTENT_ANALYSIS_PROMPT                     â”‚        â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    return {"intent": {...}, "execution_step": "planning"}â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“ (State ì—…ë°ì´íŠ¸ í›„ ë‹¤ìŒ ë…¸ë“œë¡œ)                  â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 4-B. ë‹¤ìŒ: build_plan                          â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:85 (add_node)                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:90 (add_edge)                 â”‚        â”‚
  â”‚    â”‚    â†“ ë…¸ë“œ í•¨ìˆ˜ ì‹¤í–‰                            â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor/plan_builder.py:170-193          â”‚        â”‚
  â”‚    â”‚    async def build_plan_node(state, runtime)  â”‚        â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    intent = state["intent"]       â† ì´ì „ ë…¸ë“œ ê²°ê³¼â”‚      â”‚
  â”‚    â”‚    â†“ ê·œì¹™ ê¸°ë°˜ ê³„íš ìƒì„±                       â”‚        â”‚
  â”‚    â”‚ ğŸ“ plan_builder.py:17-117                      â”‚        â”‚
  â”‚    â”‚    build_plan_rule_based(intent)              â”‚        â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    return {"execution_plan": {...}, ...}      â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“                                                   â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 4-C. ë‹¤ìŒ: execute_agents                      â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:86 (add_node)                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:91 (add_edge)                 â”‚        â”‚
  â”‚    â”‚    â†“ ë…¸ë“œ í•¨ìˆ˜ ì‹¤í–‰                            â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor/execution_coordinator.py:145-182 â”‚        â”‚
  â”‚    â”‚    async def execute_agents_node(state, runtime)â”‚       â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    plan = state["execution_plan"]             â”‚        â”‚
  â”‚    â”‚    â†“ ì „ëµë³„ ì‹¤í–‰                               â”‚        â”‚
  â”‚    â”‚ ğŸ“ execution_coordinator.py:87-112 (sequential)â”‚        â”‚
  â”‚    â”‚    await execute_sequential(agents, ctx)      â”‚        â”‚
  â”‚    â”‚    â†“ Agentë³„ ì‹¤í–‰                              â”‚        â”‚
  â”‚    â”‚ ğŸ“ execution_coordinator.py:54-79              â”‚        â”‚
  â”‚    â”‚    await execute_agent(agent_config, ctx)     â”‚        â”‚
  â”‚    â”‚    â†“ Mock Agent ì‚¬ìš© (í˜„ì¬)                    â”‚        â”‚
  â”‚    â”‚ ğŸ“ execution_coordinator.py:17-51              â”‚        â”‚
  â”‚    â”‚    get_agent(agent_name)                      â”‚        â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    return {"agent_results": {...}, ...}       â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“                                                   â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 4-D. ë‹¤ìŒ: evaluate_results                    â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:87 (add_node)                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:92 (add_edge)                 â”‚        â”‚
  â”‚    â”‚    â†“ ë…¸ë“œ í•¨ìˆ˜ ì‹¤í–‰                            â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor/result_evaluator.py:148-197      â”‚        â”‚
  â”‚    â”‚    async def evaluate_results_node(state, runtime)â”‚     â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    agent_results = state["agent_results"]     â”‚        â”‚
  â”‚    â”‚    â†“ í’ˆì§ˆ í‰ê°€                                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ result_evaluator.py:17-58 (rule_based)     â”‚        â”‚
  â”‚    â”‚    evaluate_quality_rule_based(agent_results) â”‚        â”‚
  â”‚    â”‚    â†“ ì‘ë‹µ í¬ë§·íŒ…                               â”‚        â”‚
  â”‚    â”‚ ğŸ“ result_evaluator.py:86-115 (simple)         â”‚        â”‚
  â”‚    â”‚    format_response_simple(query, agent_results)â”‚       â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    return {"evaluation": {...}, "final_output": {...}}â”‚ â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“                                                   â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚    â”‚ 4-E. ì¡°ê±´ë¶€ ë¶„ê¸°: should_retry                 â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:95-116 (í•¨ìˆ˜ ì •ì˜)            â”‚        â”‚
  â”‚    â”‚ ğŸ“ supervisor.py:118-125 (add_conditional_edges)â”‚       â”‚
  â”‚    â”‚    â†“                                           â”‚        â”‚
  â”‚    â”‚    if needs_retry and retry_count < 2:        â”‚        â”‚
  â”‚    â”‚        return "retry"  â†’ execute_agents ì¬ì‹¤í–‰ â”‚        â”‚
  â”‚    â”‚    else:                                       â”‚        â”‚
  â”‚    â”‚        return "end"    â†’ END                   â”‚        â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚          â†“ (ì¬ì‹œë„ ì—†ìœ¼ë©´)                                  â”‚
  â”‚    ğŸ“ supervisor.py:123 (END)                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 5ï¸âƒ£ BaseAgent.execute() ê²°ê³¼ ë°˜í™˜                            â”‚
  â”‚    ğŸ“ base_agent.py:327-339                                  â”‚
  â”‚    â†“                                                         â”‚
  â”‚    return {                                                  â”‚
  â”‚        "status": "success",                                  â”‚
  â”‚        "data": result,  â† ìµœì¢… State (final_output í¬í•¨)     â”‚
  â”‚        "agent": "real_estate_supervisor",                    â”‚
  â”‚        "context": {...}                                      â”‚
  â”‚    }                                                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 6ï¸âƒ£ process_query() ìµœì¢… ì‘ë‹µ ì¶”ì¶œ                           â”‚
  â”‚    ğŸ“ supervisor.py:198-206                                  â”‚
  â”‚    â†“                                                         â”‚
  â”‚    if result["status"] == "success":                         â”‚
  â”‚        return result["data"]["final_output"]                 â”‚
  â”‚    else:                                                     â”‚
  â”‚        return {"error": ..., "status": "failed"}             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 7ï¸âƒ£ ì‚¬ìš©ìì—ê²Œ ìµœì¢… ì‘ë‹µ                                      â”‚
  â”‚    {                                                         â”‚
  â”‚        "answer": "ê°•ë‚¨êµ¬ ì•„íŒŒíŠ¸ ë§¤ë§¤ ì‹œì„¸ëŠ”...",              â”‚
  â”‚        "listings": [...],                                    â”‚
  â”‚        "insights": [...],                                    â”‚
  â”‚        "metadata": {...}                                     â”‚
  â”‚    }                                                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ---
  ğŸ”‘ í•µì‹¬ ìƒì† & í˜¸ì¶œ ê´€ê³„

  1. í´ë˜ìŠ¤ ìƒì† êµ¬ì¡°

  BaseAgent (ì¶”ìƒ í´ë˜ìŠ¤)
  ğŸ“ core/base_agent.py:24-325
      â”œâ”€ __init__()
      â”œâ”€ execute()              â† í•µì‹¬ ì‹¤í–‰ ë©”ì„œë“œ
      â”œâ”€ _validate_input()      â† ì¶”ìƒ ë©”ì„œë“œ
      â”œâ”€ _build_graph()         â† ì¶”ìƒ ë©”ì„œë“œ
      â”œâ”€ _get_state_schema()    â† ì¶”ìƒ ë©”ì„œë“œ
      â””â”€ _create_initial_state()

           â†“ ìƒì†

  RealEstateSupervisor (êµ¬ì²´ í´ë˜ìŠ¤)
  ğŸ“ supervisor/supervisor.py:30-207
      â”œâ”€ __init__()             â†’ super().__init__() í˜¸ì¶œ
      â”œâ”€ _validate_input()      â†’ ì˜¤ë²„ë¼ì´ë“œ (query ê²€ì¦)
      â”œâ”€ _build_graph()         â†’ ì˜¤ë²„ë¼ì´ë“œ (StateGraph êµ¬ì„±)
      â”œâ”€ _get_state_schema()    â†’ ì˜¤ë²„ë¼ì´ë“œ (SupervisorState ë°˜í™˜)
      â”œâ”€ _create_initial_state()â†’ ì˜¤ë²„ë¼ì´ë“œ (create_supervisor_initial_state í˜¸ì¶œ)     
      â””â”€ process_query()        â†’ í¸ì˜ ë©”ì„œë“œ (execute ë˜í•‘)

  2. State ê´€ë¦¬ íë¦„

  SupervisorState (TypedDict)
  ğŸ“ core/states.py:145-199
      â”œâ”€ query: str
      â”œâ”€ intent: Optional[Dict]
      â”œâ”€ execution_plan: Optional[Dict]
      â”œâ”€ agent_results: Annotated[Dict, merge_dicts]
      â”œâ”€ evaluation: Optional[Dict]
      â””â”€ final_output: Optional[Dict]

           â†“ ì´ˆê¸°í™”

  create_supervisor_initial_state()
  ğŸ“ core/states.py:290-325
      â””â”€ ëª¨ë“  í•„ë“œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”

           â†“ ê° ë…¸ë“œì—ì„œ ì—…ë°ì´íŠ¸

  analyze_intent_node       â†’ state["intent"] ì—…ë°ì´íŠ¸
  build_plan_node           â†’ state["execution_plan"] ì—…ë°ì´íŠ¸
  execute_agents_node       â†’ state["agent_results"] ì—…ë°ì´íŠ¸
  evaluate_results_node     â†’ state["evaluation"], state["final_output"] ì—…ë°ì´íŠ¸       

  3. Context ê´€ë¦¬ íë¦„

  AgentContext (TypedDict)
  ğŸ“ core/context.py:14-37
      â”œâ”€ user_id: str (í•„ìˆ˜)
      â”œâ”€ session_id: str (í•„ìˆ˜)
      â”œâ”€ request_id: Optional[str]
      â”œâ”€ api_keys: Optional[Dict]
      â””â”€ debug_mode: Optional[bool]

           â†“ ìƒì„±

  create_agent_context(user_id, session_id, **kwargs)
  ğŸ“ core/context.py:74-111
      â””â”€ Context ë”•ì…”ë„ˆë¦¬ ìƒì„±

           â†“ ì „ë‹¬

  BaseAgent._create_context()
  ğŸ“ core/base_agent.py:105-125
      â””â”€ input_dataì—ì„œ Context ì¶”ì¶œ

           â†“ LangGraphì— ì „ë‹¬

  app.ainvoke(state, config, context=context)
  ğŸ“ base_agent.py:319-323

           â†“ ë…¸ë“œì—ì„œ ì ‘ê·¼

  async def node(state, runtime):
      ctx = await runtime.context()  â† READ-ONLYë¡œ ì ‘ê·¼
      api_key = ctx.get("api_keys", {}).get("openai_api_key")

  ---
  ğŸ’¡ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ê²ƒë“¤

  1ï¸âƒ£ ìµœì´ˆ ì§„ì…ì 

  # ì‚¬ìš©ì ì½”ë“œ
  supervisor = RealEstateSupervisor()
  í˜¸ì¶œ ìˆœì„œ:
  1. RealEstateSupervisor.__init__() (supervisor.py:39)
  2. super().__init__() â†’ BaseAgent.__init__() (base_agent.py:31)
  3. self._build_graph() â†’ RealEstateSupervisor._build_graph() (supervisor.py:59)       

  2ï¸âƒ£ ìµœì´ˆ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤

  class RealEstateSupervisor(BaseAgent):
      ...
  - ë¶€ëª¨ í´ë˜ìŠ¤: BaseAgent (core/base_agent.py:24)
  - ìƒì† ë°›ëŠ” ë©”ì„œë“œ:
    - execute() - í•µì‹¬ ì‹¤í–‰ ë¡œì§
    - _create_context() - Context ìƒì„±
    - _wrap_node_with_runtime() - Runtime ì£¼ì…
    - get_state() - ìƒíƒœ ì¡°íšŒ
    - update_state() - ìƒíƒœ ì—…ë°ì´íŠ¸

  3ï¸âƒ£ ìµœì´ˆ ì‹¤í–‰ë˜ëŠ” ë©”ì„œë“œ

  result = await supervisor.process_query("ê°•ë‚¨ì—­ ì•„íŒŒíŠ¸")
  í˜¸ì¶œ ìˆœì„œ:
  1. process_query() (supervisor.py:173)
  2. self.execute() â†’ BaseAgent.execute() (base_agent.py:259)
  3. self._validate_input() â†’ RealEstateSupervisor._validate_input()
  (supervisor.py:132)
  4. self._create_initial_state() â†’ RealEstateSupervisor._create_initial_state()        
  (supervisor.py:157)
  5. self._create_context() â†’ BaseAgent._create_context() (base_agent.py:105)
  6. app.ainvoke() â†’ LangGraph ì‹¤í–‰

  ---
  ğŸ“Š State ì—…ë°ì´íŠ¸ ì¶”ì 

  # ì´ˆê¸° State (base_agent.py:284)
  initial_state = {
      "status": "pending",
      "query": "ê°•ë‚¨ì—­ ì•„íŒŒíŠ¸",
      "intent": None,
      ...
  }

  # â†’ analyze_intent_node ì‹¤í–‰ í›„ (intent_analyzer.py:100-106)
  state = {
      "status": "processing",
      "query": "ê°•ë‚¨ì—­ ì•„íŒŒíŠ¸",
      "intent": {"intent_type": "search", ...},  â† ì¶”ê°€
      "execution_step": "planning",  â† ì—…ë°ì´íŠ¸
      ...
  }

  # â†’ build_plan_node ì‹¤í–‰ í›„ (plan_builder.py:187-191)
  state = {
      ...
      "execution_plan": {"strategy": "sequential", ...},  â† ì¶”ê°€
      "execution_step": "executing_agents",  â† ì—…ë°ì´íŠ¸
  }

  # â†’ execute_agents_node ì‹¤í–‰ í›„ (execution_coordinator.py:175-179)
  state = {
      ...
      "agent_results": {  â† merge_dictsë¡œ ë³‘í•©
          "property_search": {...},
          "market_analysis": {...}
      },
      "execution_step": "evaluating",
  }

  # â†’ evaluate_results_node ì‹¤í–‰ í›„ (result_evaluator.py:189-195)
  state = {
      ...
      "evaluation": {...},  â† ì¶”ê°€
      "final_output": {...},  â† ì¶”ê°€
      "status": "completed",
      "execution_step": "finished"
  }

  ---
  ì´ê²ƒì´ ì‚¬ìš©ì ì§ˆì˜ â†’ ì¶œë ¥ê¹Œì§€ì˜ ì™„ì „í•œ ì½”ë“œ ì—°ê²°ì ì…ë‹ˆë‹¤!